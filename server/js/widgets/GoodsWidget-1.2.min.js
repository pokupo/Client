var GoodsWidget=function(){var l=this;l.widgetName="GoodsWidget";l.version=1.2;l.minWidgetVersion=1;l.maxWidgetVersion=2;l.minTmplVersion=1;l.maxTmplVersion=2;l.goods=null;l.hasButton=false;l.InitWidget=f;var e={container:{widget:"content",def:"defaultGoodsWidgetId"},tmpl:{path:"goodsTmpl.html",id:"goodsTmpl"},animate:typeof AnimateGoods=="function"?AnimateGoods:null,showBlocks:["main","description"],infoBlock:1111111,moreBlocks:{description:"Описание",shipping:"Условия доставки",opinion:"Отзывы покупателей"},message:{maxIsReached:"Достигнут максимум"},share:{element:"share",elementStyle:{quickServices:["vkontakte","odnoklassniki","facebook","twitter","gplus"]}},galleryId:"jcarousel"};function f(){c();j();b()}function c(){var m=l.GetInputParameters("goods");if(!$.isEmptyObject(m)){e=l.UpdateSettings1(e,m);if(m.show){for(var n=0;n<=m.show.length-1;n++){if($.inArray(m.show[n],e.showBlocks)<0){e.showBlocks.push(m.show[n])}}}}Config.Containers.goods=e.container}function b(){if(Routing.route=="goods"){l.BaseLoad.Tmpl(e.tmpl,function(){l.BaseLoad.Script(PokupoWidgets.model.goods,function(){g()})})}else{l.WidgetLoader(true)}}function j(){l.AddEvent("w.change.route",function(){b()});l.AddEvent("G.info",function(m){k.Content(m)})}function g(){l.BaseLoad.InfoFavorite("no",function(m){Parameters.cache.favorite=m;l.BaseLoad.GoodsInfo(Routing.params.id,e.infoBlock,function(n){l.DispatchEvent("G.info",n)})})}function a(){l.ClearContainer(e)}function d(){l.InsertContainer(e)}var k={Content:function(n){l.goods=new GoodsViewModel(e);for(var m in n){if(typeof k[m.charAt(0).toUpperCase()+m.substr(1).toLowerCase()]=="function"){k[m.charAt(0).toUpperCase()+m.substr(1).toLowerCase()](n[m])}else{k.Block(m,n[m])}}l.goods.blocks.main.sellerId=n.seller.id;l.goods.blocks.main.shopId=n.shop.id;l.goods.SetListMoreBlock();i(l.goods)},Main:function(n){GoodsMainBlockViewModel.prototype=new Widget();l.goods.AddBlock("main",new GoodsMainBlockViewModel(n,e));var m="description";l.goods.AddBlock(m,n.description);if(n.description&&n.description.match(/data-bind/)){l.hasButton=m}},Gallery:function(o){var m=[];for(var n=0;n<=o.length-1;n++){m[n]=new GalleryBlockViewModel(o[n])}l.goods.AddBlock("gallery",m)},Seller:function(m){l.goods.sellerInfo.seller=m},Shop:function(m){l.goods.sellerInfo.shop=m},Operator:function(m){l.goods.sellerInfo.operator=m},Block:function(n,p){var q=new MoreBlockViewModel(n);if(n=="shipping"){var m=[];for(var o in p){m.push(new ShippingBlockViewModel(p[o]))}p=m}q.AddParams(p);l.goods.AddBlock(n,q)}};function i(m){d();l.RenderTemplate(m,e,function(n){if(l.hasButton){$.each(n.moreBlock,function(p){if(n.moreBlock[p].key==l.hasButton){var o=$("#"+n.moreBlock[p].idBlock+" [data-bind^=click]");$.each(o,function(q){if(n.blocks.main.showAddToCart()){if($(o[q]).attr("data-bind").match(/AddToCart/)){var s=new AddToCartButtonViewModel(n.blocks.main);ko.applyBindings(s,o[q])}}else{$(o[q]).hide()}if(n.blocks.main.showBuy()){if($(o[q]).attr("data-bind").match(/Buy/)){var r=new BuyButtonViewModel(n.blocks.main);ko.applyBindings(r,o[q])}}else{$(o[q]).hide()}})}})}h(n)},function(n){d();i(n)},function(){a()})}function h(o){var m=$.cookie(Config.Base.cookie.previously_viewed);if(!m){$.cookie(Config.Base.cookie.previously_viewed,o.id)}else{var n=m.split(",");var p=$.inArray(o.id,n);if(p>=0){n.splice(p,1);n.unshift(o.id)}else{n.unshift(o.id)}if(n.length>20){n.splice(20,1)}$.cookie(Config.Base.cookie.previously_viewed,n.join(","))}}};var TestGoods={Init:function(){if(typeof Widget=="function"){GoodsWidget.prototype=new Widget();var a=new GoodsWidget();a.Init(a)}else{setTimeout(function(){TestGoods.Init()},100)}}};TestGoods.Init();