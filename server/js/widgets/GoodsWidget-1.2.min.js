var GoodsWidget=function(){function o(){e(),n(),i()}function e(){var o=c.GetInputParameters("goods");if(!$.isEmptyObject(o)&&(l=c.UpdateSettings1(l,o),o.show))for(var e=0;e<=o.show.length-1;e++)$.inArray(o.show[e],l.showBlocks)<0&&l.showBlocks.push(o.show[e]);Config.Goods=l}function i(){"goods"==Routing.route?c.BaseLoad.Tmpl(l.tmpl,function(){c.BaseLoad.Script(PokupoWidgets.model.goods,function(){t()})}):c.WidgetLoader(!0)}function n(){c.AddEvent("w.change.route",function(){i()}),c.AddEvent("G.info",function(o){f.Content(o)})}function t(){c.BaseLoad.InfoFavorite("no",function(o){Parameters.cache.favorite=o,c.BaseLoad.GoodsInfo(Routing.params.id,l.infoBlock,function(o){c.DispatchEvent("G.info",o)})})}function s(){c.ClearContainer(l)}function d(){c.InsertContainer(l)}function a(o){d(),c.RenderTemplate(o,l,function(o){c.hasButton&&$.each(o.moreBlock,function(e){if(o.moreBlock[e].key==c.hasButton){var i=$("#"+o.moreBlock[e].idBlock+" [data-bind^=click]");$.each(i,function(e){if(o.blocks.main.showAddToCart()){if($(i[e]).attr("data-bind").match(/AddToCart/)){var n=new AddToCartButtonViewModel(o.blocks.main);ko.applyBindings(n,i[e])}}else $(i[e]).hide();if(o.blocks.main.showBuy()){if($(i[e]).attr("data-bind").match(/Buy/)){var t=new BuyButtonViewModel(o.blocks.main);ko.applyBindings(t,i[e])}}else $(i[e]).hide()})}}),r(o)},function(o){d(),a(o)},function(){s()})}function r(o){var e=$.cookie(Config.Base.cookie.previously_viewed);if(e){var i=e.split(","),n=$.inArray(o.id,i);n>=0?(i.splice(n,1),i.unshift(o.id)):i.unshift(o.id),i.length>20&&i.splice(20,1),$.cookie(Config.Base.cookie.previously_viewed,i.join(","))}else $.cookie(Config.Base.cookie.previously_viewed,o.id)}var c=this;c.widgetName="GoodsWidget",c.version=1.2,c.minWidgetVersion=1,c.maxWidgetVersion=2,c.minTmplVersion=1,c.maxTmplVersion=2,c.goods=null,c.hasButton=!1,c.InitWidget=o;var l={container:{widget:"content",def:"defaultGoodsWidgetId"},tmpl:{path:"goodsTmpl.html",id:"goodsTmpl"},animate:"function"==typeof AnimateGoods?AnimateGoods:null,showBlocks:["main","description"],infoBlock:1111111,moreBlocks:{description:"Описание",shipping:"Условия доставки",opinion:"Отзывы покупателей"},message:{maxIsReached:"Достигнут максимум"},share:{element:"share",elementStyle:{quickServices:["vkontakte","odnoklassniki","facebook","twitter","gplus"]}},galleryId:"jcarousel"},f={Content:function(o){c.goods=new GoodsViewModel;for(var e in o)"function"==typeof f[e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()]?f[e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()](o[e]):f.Block(e,o[e]);c.goods.blocks.main.sellerId=o.seller.id,c.goods.blocks.main.shopId=o.shop.id,c.goods.SetListMoreBlock(),a(c.goods)},Main:function(o){GoodsMainBlockViewModel.prototype=new Widget,c.goods.AddBlock("main",new GoodsMainBlockViewModel(o));var e="description";c.goods.AddBlock(e,o.description),o.description&&o.description.match(/data-bind/)&&(c.hasButton=e)},Gallery:function(o){for(var e=[],i=0;i<=o.length-1;i++)e[i]=new GalleryBlockViewModel(o[i]);c.goods.AddBlock("gallery",e)},Seller:function(o){c.goods.sellerInfo.seller=o},Shop:function(o){c.goods.sellerInfo.shop=o},Operator:function(o){c.goods.sellerInfo.operator=o},Block:function(o,e){var i=new MoreBlockViewModel(o);if("shipping"==o){var n=[];for(var t in e)n.push(new ShippingBlockViewModel(e[t]));e=n}i.AddParams(e),c.goods.AddBlock(o,i)}}},TestGoods={Init:function(){if("function"==typeof Widget){GoodsWidget.prototype=new Widget;var o=new GoodsWidget;o.Init(o)}else setTimeout(function(){TestGoods.Init()},100)}};TestGoods.Init();