var UserInformationWidget=function(){function n(){t(),o(),e()}function o(){var n=m.GetInputParameters("userInformation");if(!$.isEmptyObject(n)&&(g=m.UpdateSettings1(g,n),n.show))for(var o=0;o<=n.show.length-1;o++)$.inArray(n.show[o],g.showBlocks)<0&&g.showBlocks.push(n.show[o]);Config.UserInformation=g}function e(){m.BaseLoad.Tmpl(g.tmpl,function(){m.DispatchEvent("UInfo.tmpl")})}function t(){m.AddEvent("UInfo.tmpl",function(){m.BaseLoad.Login(!1,!1,!1,function(n){i(n)})}),m.AddEvent("w.auth.ok",function(n){i(n.request)}),m.AddEvent("UInfo.logout",function(){m.BaseLoad.Logout(function(n){("ok"==n.result||"fail"==n.result)&&(m.BaseLoad.LogoutForProxy(),Routing.SetHash("default","Домашняя",{}))})}),m.AddEvent("w.change.route",function(){m.BaseLoad.Tmpl(g.tmpl,function(){m.DispatchEvent("UInfo.tmpl")})})}function i(n){Routing.IsDefault()&&m.HasDefaultContent()?m.WidgetLoader(!0):n.err?(a(),c()):(s(),u(n))}function r(){m.ClearContainer(g)}function a(){m.InsertContainer(g,"auth")}function s(){m.InsertContainer(g,"info")}function c(){var n=new UserAuthorizationBlockViewModel;f(n)}function u(n){m.BaseLoad.MessageCountUnread(function(o){Parameters.cache.message.countNewMessage(parseInt(o.count_unread_topic)),UserInformationBlockViewModel.prototype=new Widget;var e=new UserInformationBlockViewModel(n,g);l(e)})}function f(n){m.RenderTemplate(n,g,null,function(n){a(),f(n)},function(){r()})}function l(n){m.RenderTemplate(n,g,null,function(n){s(),l(n)},function(){r()})}var m=this;m.widgetName="UserInformationWidget",m.version=1,m.minWidgetVersion=1,m.maxWidgetVersion=2,m.minTmplVersion=1,m.maxTmplVersion=2,m.InitWidget=n;var g={container:{widget:"userInformationWidgetId",def:"defaultUserInformationWidgetId"},tmpl:{path:"userInformationTmpl.html",id:{info:"userInformationTmpl",auth:"authorizationLinkTmpl"}},message:{confirmLogOut:"Вы действительно хотите выйти?"},showBlocks:["login"],animate:"function"==typeof AnimateUserInformation?AnimateUserInformation:null}},UserAuthorizationBlockViewModel=function(){var n=this;n.ClickLogin=function(){Parameters.cache.lastPage=Parameters.cache.history[Parameters.cache.history.length-1],Routing.SetHash("login","Авторизация пользователя",{})},n.ClickRegistration=function(){Parameters.cache.lastPage=Parameters.cache.history[Parameters.cache.history.length-1],Routing.SetHash("registration","Регистрация пользователя",{step:1})}},UserInformationBlockViewModel=function(n,o){function e(n,o,e){Routing.SetHash(n,o,e)}var t=this;t.email=n.email,t.login=n.login,t.phone=n.phone,t.countNewMessage=ko.computed(function(){return Parameters.cache.message.countNewMessage()},this),t.showIcon=function(){return!n.route_icon_user||$.inArray("icon",o.showBlocks)<0?!1:!0},t.iconUser="",n.route_icon_user&&(t.iconUser=n.route_icon_user+"?"+EventDispatcher.HashCode(EventDispatcher.GetUUID())),t.background="",t.backgroundImage="",t.iconUser&&(t.background="background: url('"+t.iconUser+"')",t.backgroundImage="background-image: url('"+t.iconUser+"')"),t.showRaiting=function(){return $.inArray("raiting",o.showBlocks)<0?!1:!0},t.ratingUser=n.rating_user,t.showProfile=function(){return $.inArray("profile",o.showBlocks)<0?!1:!0},t.ClickLogout=function(){t.Confirm(o.message.confirmLogOut,function(){Loader.Indicator("UserInformationWidget",!1),EventDispatcher.DispatchEvent("UInfo.logout")},!1)},t.ClickPrivateOffice=function(){e("profile","Личный кабинет",{})},t.ClickMessages=function(){e("messages","Сообщения",{})},t.ClickFavorites=function(){e("favorites","Избранное",{})},t.ClickPurchases=function(){e("purchases","Мои покупки",{block:"list"})},t.ClickProfile=function(){e("profile","Личный кабинет",{})}},TestUserInformation={Init:function(){if("function"==typeof Widget){UserInformationWidget.prototype=new Widget;var n=new UserInformationWidget;n.Init(n)}else setTimeout(function(){TestUserInformation.Init()},100)}};TestUserInformation.Init();