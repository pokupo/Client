window.RelatedGoodsWidget=function(){var j=this;j.widgetName="RelatedGoodsWidget";j.version=1;j.minWidgetVersion=1;j.maxWidgetVersion=2;j.minTmplVersion=1;j.maxTmplVersion=2;j.InitWidget=g;var e={container:null,tmpl:{path:"relatedGoodsTmpl.html",id:{table:"relatedGoodsTableTmpl",list:"relatedGoodsListTmpl",tile:"relatedGoodsTileTmpl",slider:"relatedGoodsSliderTmpl",carousel:"relatedGoodsCarouselTmpl"}},animate:typeof AnimateRelatedGoods=="function"?AnimateRelatedGoods:null,id:null,count:6,countTile:5,orderBy:"rating",start:0,typeView:"carousel",uniq:null};function g(){Loader.InsertContainer(e.container);i();if(Loader.IsReady()){h()}}j.SetParameters=function(m){e.container=m.element;var n=m.options.params;for(var l in n){if(l=="tmpl"&&n.tmpl){if(n.tmpl.path){e.tmpl.path=n.tmpl.path}if(n.tmpl.id){e.tmpl.id=n.tmpl.id}}else{if(l=="uniq"&&n.uniq){e.uniq=n.uniq}else{if(l=="animate"&&n.animate){e.animate=n.animate}else{if(l=="id"){e.id=n.id}}}}}var k=j.GetInputParameters("relatedGoods");if(!$.isEmptyObject(k)){e=j.UpdateSettings1(e,k)}Config.RelatedGoods=e};function h(){j.BaseLoad.Tmpl(e.tmpl,function(){j.BaseLoad.Script(PokupoWidgets.model.content,function(){j.DispatchEvent("RGoods.onload.tmpl_"+e.uniq)})})}function i(){j.AddEvent("w.ready",function(){if(e.container){h()}});j.AddEvent("RGoods.onload.tmpl_"+e.uniq,function(l){var k=e.start+"/"+e.count+"/"+e.orderBy;j.BaseLoad.RelatedGoods(e.id,k,function(m){b(m)})});j.AddEvent("RGoods.fill.block_"+e.uniq,function(k){f(k)});j.AddEvent("w.change.route",function(){e.container=null})}function a(){$(e.container).html()}function c(k){if(k=="slider"){$(e.container).html($("script#"+j.GetTmplName1(e,"slider")).html())}if(k=="carousel"){$(e.container).html($("script#"+j.GetTmplName1(e,"carousel")).html())}if(k=="tile"){$(e.container).html($("script#"+j.GetTmplName1(e,"tile")).html())}if(k=="table"){$(e.container).html($("script#"+j.GetTmplName1(e,"table")).html())}if(k=="list"){$(e.container).html($("script#"+j.GetTmplName1(e,"list")).html())}if(k=="empty"){$(e.container).html("")}}function b(k){if(!k.err){c(e.typeView);d(e,k)}else{c("empty")}}function d(k,l){var m=new RelatedGoodsViewModel(k,l);m.AddContent()}function f(k){try{ko.cleanNode($(e.container).children()[0]);ko.applyBindings(k,$(e.container).children()[0]);if(e.animate){e.animate()}}catch(l){j.Exception("Ошибка шаблона ["+j.GetTmplName1(e,k.typeView)+"]",l);if(e.tmpl.custom){delete e.tmpl.custom;j.BaseLoad.Tmpl(e.tmpl,function(){c(k.typeView);f(k)})}else{a()}}}};var RelatedGoodsViewModel=function(b,c){var a=this;a.typeView=b.typeView;a.countGoods=b.count;a.countTile=b.countTile;a.content=ko.observableArray();a.cssBlockContainer="relatedGoodsContainer_";a.AddContent=function(){if(c&&c.length>=1){var k=c.shift();a.countGoods=k.count_goods;if(c.length<a.countGoods){a.countGoods=c.length}var g=0;for(var e=0;e<=a.countGoods-1;e++){if(a.typeView=="tile"){var h=new BlockTrForTableViewModel();for(var d=0;d<=a.countTile-1;d++){if(c[g]){h.AddStr(new ContentViewModel(c[g],g));g++}else{break}}if(h.str().length>0){a.content.push(h)}delete h}else{a.content.push(new ContentViewModel(c[e],e))}}a.cssBlockContainer=a.cssBlockContainer+EventDispatcher.HashCode(c.toString());c.unshift(k)}EventDispatcher.DispatchEvent("RGoods.fill.block_"+b.uniq,a)}};