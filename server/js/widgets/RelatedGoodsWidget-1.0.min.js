window.RelatedGoodsWidget=function(){function t(){Loader.InsertContainer(s.container),n(),Loader.IsReady()&&e()}function e(){r.BaseLoad.Tmpl(s.tmpl,function(){r.BaseLoad.Script(PokupoWidgets.model.content,function(){r.DispatchEvent("RGoods.onload.tmpl_"+s.uniq)})})}function n(){r.AddEvent("w.ready",function(){s.container&&e()}),r.AddEvent("RGoods.onload.tmpl_"+s.uniq,function(){var t=s.start+"/"+s.count+"/"+s.orderBy;r.BaseLoad.RelatedGoods(s.id,t,function(t){l(t)})}),r.AddEvent("RGoods.fill.block_"+s.uniq,function(t){d(t)}),r.AddEvent("w.change.route",function(){s.container=null})}function o(){$(s.container).html()}function i(t){"slider"==t&&$(s.container).html($("script#"+r.GetTmplName1(s,"slider")).html()),"carousel"==t&&$(s.container).html($("script#"+r.GetTmplName1(s,"carousel")).html()),"tile"==t&&$(s.container).html($("script#"+r.GetTmplName1(s,"tile")).html()),"table"==t&&$(s.container).html($("script#"+r.GetTmplName1(s,"table")).html()),"list"==t&&$(s.container).html($("script#"+r.GetTmplName1(s,"list")).html()),"empty"==t&&$(s.container).html("")}function l(t){t.err?i("empty"):(i(s.typeView),a(s,t))}function a(t,e){var n=new RelatedGoodsViewModel(t,e);n.AddContent()}function d(t){try{ko.cleanNode($(s.container).children()[0]),ko.applyBindings(t,$(s.container).children()[0]),s.animate&&s.animate()}catch(e){r.Exception("Ошибка шаблона ["+r.GetTmplName1(s,t.typeView)+"]",e),s.tmpl.custom?(delete s.tmpl.custom,r.BaseLoad.Tmpl(s.tmpl,function(){i(t.typeView),d(t)})):o()}}var r=this;r.widgetName="RelatedGoodsWidget",r.version=1,r.minWidgetVersion=1,r.maxWidgetVersion=2,r.minTmplVersion=1,r.maxTmplVersion=2,r.InitWidget=t;var s={container:null,tmpl:{path:"relatedGoodsTmpl.html",id:{table:"relatedGoodsTableTmpl",list:"relatedGoodsListTmpl",tile:"relatedGoodsTileTmpl",slider:"relatedGoodsSliderTmpl",carousel:"relatedGoodsCarouselTmpl"}},animate:"function"==typeof AnimateRelatedGoods?AnimateRelatedGoods:null,id:null,count:6,countTile:5,orderBy:"rating",start:0,typeView:"carousel",uniq:null};r.SetParameters=function(t){s.container=t.element;var e=t.options.params;for(var n in e)"tmpl"==n&&e.tmpl?(e.tmpl.path&&(s.tmpl.path=e.tmpl.path),e.tmpl.id&&(s.tmpl.id=e.tmpl.id)):"uniq"==n&&e.uniq?s.uniq=e.uniq:"animate"==n&&e.animate?s.animate=e.animate:"id"==n&&(s.id=e.id);var o=r.GetInputParameters("relatedGoods");$.isEmptyObject(o)||(s=r.UpdateSettings1(s,o)),Config.RelatedGoods=s}};var RelatedGoodsViewModel=function(t,e){var n=this;n.typeView=t.typeView,n.countGoods=t.count,n.countTile=t.countTile,n.content=ko.observableArray(),n.cssBlockContainer="relatedGoodsContainer_",n.AddContent=function(){if(e&&e.length>=1){var o=e.shift();n.countGoods=o.count_goods,e.length<n.countGoods&&(n.countGoods=e.length);for(var i=0,l=0;l<=n.countGoods-1;l++)if("tile"==n.typeView){for(var a=new BlockTrForTableViewModel,d=0;d<=n.countTile-1&&e[i];d++)a.AddStr(new ContentViewModel(e[i],i)),i++;a.str().length>0&&n.content.push(a),delete a}else n.content.push(new ContentViewModel(e[l],l));n.cssBlockContainer=n.cssBlockContainer+EventDispatcher.HashCode(e.toString()),e.unshift(o)}EventDispatcher.DispatchEvent("RGoods.fill.block_"+t.uniq,n)}};