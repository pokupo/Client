var SearchWidget=function(){function e(){c(),t(),i()}function t(){var e=d.GetInputParameters("search");$.isEmptyObject(e)||(g=d.UpdateSettings1(g,e)),Config.Search=g}function r(){d.ClearContainer(g)}function a(){d.InsertContainer(g)}function i(){Routing.IsDefault()&&d.HasDefaultContent()?d.WidgetLoader(!0,g.container.widget):o()}function o(){d.BaseLoad.Tmpl(g.tmpl,function(){d.BaseLoad.Roots(function(){d.BaseLoad.Section(Routing.GetActiveCategory(),function(){d.BaseLoad.Info(Routing.GetActiveCategory(),function(e){s(e)})})})})}function c(){d.AddEvent("Search.fill.categories",function(e){a(),n(e)}),d.AddEvent("w.change.route",function(){i()})}function s(e){SearchViewModel.prototype=new Widget;var t=new SearchViewModel(g);t.AddListCategory(e)}function n(e){d.RenderTemplate(e,g,null,function(e){a(),n(e)},function(){r()})}var d=this;d.widgetName="SearchWidget",d.version=1,d.minWidgetVersion=1,d.maxWidgetVersion=2,d.minTmplVersion=1,d.maxTmplVersion=2,d.InitWidget=e;var g={container:{widget:"searchWidgetId",def:"defaultSearchWidgetId"},showCatalog:!0,tmpl:{path:"searchTmpl.html",id:"searchTmpl"},message:{empty:"Введите название товара для его поиска."},animate:"function"==typeof AnimateSearch?AnimateSearch:null}},SearchCategoryItem=function(e,t,r){var a=this;a.id=e.id,a.title=Array(t).join(" - ")+e.name_category,a.typeCategory=e.type_category,a.isSelected=ko.computed(function(){return r.selectedCatigoriesId()==a.id?!0:!1},this),a.ClickItem=function(){r.selectedCatigoriesId(a.id),r.selectedCatigory(a.title)}},SearchCategoryItemForTree=function(e,t,r){var a=this;a.id=e.id,a.title=e.name_category,a.typeCategory=e.type_category,a.children=ko.observableArray(),a.isSelected=ko.computed(function(){return r.selectedCatigoriesId()==a.id?(r.selectedCatigory(a.title),!0):!1},this),a.ClickItem=function(){r.selectedCatigoriesId(a.id),r.selectedCatigory(a.title)}},SearchViewModel=function(e){function t(e,a){for(var i=0;i<=e.length-1;i++){if(e[i].id==a&&e[i].children){r(e[i].children);break}e[i].children&&t(e[i].children,a)}}function r(e){for(var t=0;t<=e.length-1;t++)"category"==e[t].type_category&&a.idCategories.push(e[t].id),e[t].children&&r(e[t].children)}var a=this;a.text=ko.observable(),"search"==Routing.route&&a.text(Parameters.filter.keyWords),a.cssSelectList="searchSelectList",a.categories=ko.observableArray(),a.categoriesTree=ko.observableArray(),a.selectedCatigoriesId=ko.observable(),"search"==Routing.route&&Parameters.filter.idSelectCategories&&1==Parameters.filter.idSelectCategories.length&&a.selectedCatigoriesId(Parameters.filter.idSelectCategories[0]),a.selectedCatigory=ko.observable(),a.idCategories=Parameters.filter.idCategories,a.typeCategories=[],a.cachData={},a.showCatalog=e.showCatalog,a.ClickAdvancedSearch=function(){a.DispatchEvent("SearchR.show.form")},a.AddListCategory=function(e){if(Parameters.cache.childrenCategory[e.id]){var t=Parameters.cache.childrenCategory[e.id];a.categories=ko.observableArray(),a.categoriesTree=ko.observableArray(),a.childrenCategories=ko.observableArray(),a.typeCategories=[],a.cachData=[{id:e.id,type_category:e.type_category,children:t}],a.typeCategories[e.id]=e.type_category,a.categories.push(new SearchCategoryItem(e,0,a));for(var r=0;r<=t.length-1;r++){a.categories.push(new SearchCategoryItem(t[r],1,a)),a.typeCategories[t[r].id]=t[r].type_category;var i=new SearchCategoryItemForTree(t[r],r+1,a),o=ko.observableArray();if(t[r].children){for(var c=0;c<=t[r].children.length-1;c++)a.categories.push(new SearchCategoryItem(t[r].children[c],2,a)),a.typeCategories[t[r].id]=t[r].type_category,o.push(new SearchCategoryItemForTree(t[r].children[c],2,a));i.children=o}a.childrenCategories.push(i)}var e=new SearchCategoryItemForTree(e,0,a);e.children=a.childrenCategories,a.categoriesTree.push(e)}a.DispatchEvent("Search.fill.categories",a)},a.SubmitSearchForm=function(r){a.idCategories=[];var i=a.selectedCatigoriesId(),o=$(r.text).val();o?("category"!=a.typeCategories[i]?t(a.cachData,i):a.idCategories.push(i),Parameters.SetDefaultFilterParameters(),Parameters.filter.idSelectCategories=[i],Parameters.filter.keyWords=o,0==a.idCategories.length&&(a.idCategories=[i]),Parameters.filter.idCategories=a.idCategories,Routing.SetHash("search","Расширенный поиск",Parameters.filter),a.DispatchEvent("w.change.breadCrumb",i)):a.ShowMessage(e.message.empty,!1,!1)},a.ClickSearchForm=function(){a.idCategories=[];var e=a.selectedCatigoriesId(),r=a.text();r?("category"!=a.typeCategories[e]?t(a.cachData,e):a.idCategories.push(e),Parameters.SetDefaultFilterParameters(),Parameters.filter.idSelectCategories=[e],Parameters.filter.keyWords=r,0==a.idCategories.length&&(a.idCategories=[e]),Parameters.filter.idCategories=a.idCategories,Routing.SetHash("search","Расширенный поиск",Parameters.filter),a.DispatchEvent("w.change.breadCrumb",e)):a.ShowMessage(Config.Search.message.empty,!1,!1)}},TestSearch={Init:function(){if("function"==typeof Widget){SearchWidget.prototype=new Widget;var e=new SearchWidget;e.Init(e)}else setTimeout(function(){TestSearch.Init()},100)}};TestSearch.Init();