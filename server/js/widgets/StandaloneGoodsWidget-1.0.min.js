var StandaloneGoodsWidget=function(){function o(){n(),i(),e()}function n(){function o(o){e[o]&&$.inArray(o,i.showBlocks)<0&&i.showBlocks.push(o)}var n=c.GetInputParameters("standaloneGoods"),e=Routing.params,i=i;if(e.id&&(i.idGoods=e.id),e.idShopPartner&&(i.idShopPartner=e.idShopPartner),e.mailUser&&(i.mailUser=e.mailUser),e.idMethodPayment&&(i.idMethodPayment=e.idMethodPayment),e.button&&(i.button.active=e.button),e.count&&(i.count=e.count),n.infoBlock&&(i.infoBlock=n.infoBlock),!$.isEmptyObject(n)){if(i=c.UpdateSettings1(i,n),n.show)for(var t=0;t<=n.show.length-1;t++)$.inArray(n.show[t],i.showBlocks)<0&&i.showBlocks.push(n.show[t]);n.button&&(i.button.active=n.button)}var l=["blockIdGoods","blockShortName","blockFullName","blockGallery","blockShop","blockInfoSeller","blockCount","editableCount","blockShare","blockDescription","blockShipping","blockOpinion"];if($.each(l,function(n,e){o(e)}),!$.isEmptyObject(n)&&n.hide)for(var t=0;t<=n.hide.length-1;t++){var a=$.inArray(n.hide[t],i.showBlocks);a>0&&i.showBlocks.splice(a,1)}Config.StandaloneGoods=i}function e(){"goods"==Routing.route||Routing.IsDefault()?c.BaseLoad.Tmpl(r.tmpl,function(){c.BaseLoad.Script(PokupoWidgets.model.goods,function(){t()})}):c.WidgetLoader(!0)}function i(){c.AddEvent("w.change.route",function(){e()}),c.AddEvent("SGoods.onload.info",function(o){u.Content(o)})}function t(){c.BaseLoad.GoodsInfo(r.idGoods,r.infoBlock,function(o){c.DispatchEvent("SGoods.onload.info",o)})}function l(){c.ClearContainer(r)}function a(){c.InsertContainer(r)}function s(o){a(),c.RenderTemplate(o,r,function(o){c.hasButton&&$.each(o.moreBlock,function(n){if(o.moreBlock[n].key==c.hasButton){var e=$("#"+o.moreBlock[n].idBlock+" [data-bind^=click]");$.each(e,function(n){if(o.blocks.main.showAddToCart()){if($(e[n]).attr("data-bind").match(/AddToCart/)){var i=new AddToCartButtonViewModel(o.blocks.main);ko.applyBindings(i,e[n])}}else $(e[n]).hide();if(o.blocks.main.showBuy()){if($(e[n]).attr("data-bind").match(/Buy/)){var t=new BuyButtonViewModel(o.blocks.main);ko.applyBindings(t,e[n])}}else $(e[n]).hide()})}}),d(o)},function(o){a(),s(o)},function(){l()})}function d(o){var n=$.cookie(Config.Base.cookie.previously_viewed);if(n){var e=n.split(","),i=$.inArray(o.id,e);i>=0?(e.splice(i,1),e.unshift(o.id)):e.unshift(o.id),e.length>20&&e.splice(20,1),$.cookie(Config.Base.cookie.previously_viewed,e.join(","))}else $.cookie(Config.Base.cookie.previously_viewed,o.id);var n=$.cookie(Config.Base.cookie.previously_viewed)}var c=this;c.widgetName="StandaloneGoodsWidget",c.version=1,c.minWidgetVersion=1,c.maxWidgetVersion=2,c.minTmplVersion=1,c.maxTmplVersion=2,c.goods=null,c.hasButton=!1,c.InitWidget=o;var r={container:{widget:"standaloneGoodsWidgetId",def:"defaultStandaloneGoodsWidgetId"},tmpl:{path:"standaloneGoodsTmpl.html",id:"standaloneGoodsTmpl"},showBlocks:["main"],button:{active:"Купить",inactive:"Товар недоступен"},moreBlocks:{blockDescription:"Описание",blockShipping:"Условия доставки",blockOpinion:"Отзывы покупателей"},message:{maxIsReached:"Достигнут максимум"},share:{element:"share",elementStyle:{quickServices:["vkontakte","odnoklassniki","facebook","twitter","gplus"]}},galleryId:"jcarousel",animate:"function"==typeof AnimateStandaloneGoods?AnimateStandaloneGoods:null,infoBlock:1111111,idGoods:null,count:1,idShopPartner:null,mailUser:null,idMethodPayment:null},u={Content:function(o){StandaloneGoodsViewModel.prototype=new GoodsViewModel,c.goods=new StandaloneGoodsViewModel(r);for(var n in o)"opinion"==n&&$.inArray("blockOpinion",r.showBlocks)<0||"shipping"==n&&$.inArray("blockShipping",r.showBlocks)<0||("function"==typeof u[n.charAt(0).toUpperCase()+n.substr(1).toLowerCase()]?u[n.charAt(0).toUpperCase()+n.substr(1).toLowerCase()](o[n]):u.Block(n,o[n]));c.goods.CheckShow(),c.goods.blocks.main.sellerId=o.seller.id,c.goods.blocks.main.shopId=o.shop.id,c.goods.SetListMoreBlock("standalone"),s(c.goods)},Main:function(o){if(GoodsMainBlockViewModel.prototype=new Widget,c.goods.AddBlock("main",new GoodsMainBlockViewModel(o)),$.inArray("blockDescription",r.showBlocks)>=0){var n="blockDescription";c.goods.AddBlock(n,o.description),o.description&&o.description.match(/data-bind/)&&(c.hasButton=n)}r.count&&r.count<=c.goods.blocks.main.count()?c.goods.blocks.main.ordered(r.count):c.goods.blocks.main.count(0)},Gallery:function(o){for(var n=[],e=0;e<=o.length-1;e++)n[e]=new GalleryBlockViewModel(o[e]);c.goods.AddBlock("gallery",n)},Seller:function(o){c.goods.sellerInfo.seller=o},Shop:function(o){c.goods.sellerInfo.shop=o},Operator:function(o){c.goods.sellerInfo.operator=o},Block:function(o,n){var e=new MoreBlockViewModel(o);if("shipping"==o){var i=[];for(var t in n)i.push(new ShippingBlockViewModel(n[t]));n=i,o="blockShipping"}"opinion"==o&&(o="blockOpinion"),e.AddParams(n),c.goods.AddBlock(o,e)}}},StandaloneGoodsViewModel=function(o){function n(n){$.inArray(n,o.showBlocks)>=0&&(e.show[n]=!0)}var e=this;e.activeButton=o.button.active,e.inactiveButton=o.button.inactive,e.show={blockIdGoods:!1,blockShortName:!1,blockFullName:!1,blockGallery:!1,blockShop:!1,blockInfoSeller:!1,blockOperator:!1,blockCount:!1,editableCount:!1,blockShare:!1,blockDescription:!1,blockShipping:!1,blockOpinion:!1},e.ShowGallery=function(){return e.blocks.gallery?!0:!1},e.CheckShow=function(){for(var o in e.show)n(o)},e.SetListMoreBlock=function(n){for(var i in o.moreBlocks)inShowBlocks(i)&&(StandaloneGoodsListMoreBlockViewModel.prototype=new GoodsListMoreBlockViewModel(i,e.blocks[i],n),e.moreBlock.push(new StandaloneGoodsListMoreBlockViewModel(o)))},e.Buy=function(){var n={idGoods:o.idGoods,count:e.blocks.main.ordered()};o.idShopPartner&&(n.idShopPartner=o.idShopPartner),o.mailUser&&(n.mailUser=o.mailUser),o.idMethodPayment&&(n.idMethodPayment=o.idMethodPayment),Routing.SetHash("standalone_payment","Оплатить товар",n)}},StandaloneGoodsListMoreBlockViewModel=function(o){this.title=o.moreBlocks[this.key],this.templateName=this.prefix+this.key.charAt(0).toUpperCase()+this.key.substr(1)+"BlockTmpl"},TestStandaloneGoods={Init:function(){if("function"==typeof Widget){StandaloneGoodsWidget.prototype=new Widget;var o=new StandaloneGoodsWidget;o.Init(o)}else setTimeout(function(){TestStandaloneGoods.Init()},100)}};TestStandaloneGoods.Init();