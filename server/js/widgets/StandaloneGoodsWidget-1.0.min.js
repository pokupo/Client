var StandaloneGoodsWidget=function(){var l=this;l.widgetName="StandaloneGoodsWidget";l.version=1;l.minWidgetVersion=1;l.maxWidgetVersion=2;l.minTmplVersion=1;l.maxTmplVersion=2;l.goods=null;l.hasButton=false;l.InitWidget=f;var e={container:{widget:"content",def:"defaultStandaloneGoodsWidgetId"},tmpl:{path:"standaloneGoodsTmpl.html",id:"standaloneGoodsTmpl"},showBlocks:["main"],button:{active:"Купить",inactive:"Товар недоступен"},moreBlocks:{blockDescription:"Описание",blockShipping:"Условия доставки",blockOpinion:"Отзывы покупателей"},message:{maxIsReached:"Достигнут максимум"},share:{element:"share",elementStyle:{quickServices:["vkontakte","odnoklassniki","facebook","twitter","gplus"]}},galleryId:"jcarousel",animate:typeof AnimateStandaloneGoods=="function"?AnimateStandaloneGoods:null,infoBlock:1111111,idGoods:null,count:1,idShopPartner:null,mailUser:null,idMethodPayment:null};function f(){c();j();b()}function c(){var o=l.GetInputParameters("standaloneGoods");var m=Routing.params;if(m.id){e.idGoods=m.id}if(m.idShopPartner){e.idShopPartner=m.idShopPartner}if(m.mailUser){e.mailUser=m.mailUser}if(m.idMethodPayment){e.idMethodPayment=m.idMethodPayment}if(m.button){e.button.active=m.button}if(m.count){e.count=m.count}if(o.infoBlock){e.infoBlock=o.infoBlock}if(!$.isEmptyObject(o)){e=l.UpdateSettings1(e,o);if(o.show){for(var q=0;q<=o.show.length-1;q++){if($.inArray(o.show[q],e.showBlocks)<0){e.showBlocks.push(o.show[q])}}}}var n=["blockIdGoods","blockShortName","blockFullName","blockGallery","blockShop","blockInfoSeller","blockCount","editableCount","blockShare","blockDescription","blockShipping","blockOpinion"];$.each(n,function(t,s){p(s)});function p(s){if(m[s]&&$.inArray(s,e.showBlocks)<0){e.showBlocks.push(s)}}if(!$.isEmptyObject(o)){if(o.hide){for(var q=0;q<=o.hide.length-1;q++){var r=$.inArray(o.hide[q],e.showBlocks);if(r>0){e.showBlocks.splice(r,1)}}}}Config.Containers.standaloneGoods=e.container}function b(){if(Routing.route=="goods"||Routing.IsDefault()){console.log(e.tmpl);l.BaseLoad.Tmpl(e.tmpl,function(){console.log("templete");l.BaseLoad.Script(PokupoWidgets.model.goods,function(){console.log("model");g()})})}else{l.WidgetLoader(true)}}function j(){l.AddEvent("w.change.route",function(){b()});l.AddEvent("SGoods.onload.info",function(m){k.Content(m)})}function g(){l.BaseLoad.GoodsInfo(e.idGoods,e.infoBlock,function(m){l.DispatchEvent("SGoods.onload.info",m);console.log("ddd")})}function a(){l.ClearContainer(e)}function d(){l.InsertContainer(e)}var k={Content:function(n){StandaloneGoodsViewModel.prototype=new GoodsViewModel(e);l.goods=new StandaloneGoodsViewModel(e);for(var m in n){if(m=="opinion"&&$.inArray("blockOpinion",e.showBlocks)<0){continue}if(m=="shipping"&&$.inArray("blockShipping",e.showBlocks)<0){continue}if(typeof k[m.charAt(0).toUpperCase()+m.substr(1).toLowerCase()]=="function"){k[m.charAt(0).toUpperCase()+m.substr(1).toLowerCase()](n[m])}else{k.Block(m,n[m])}}l.goods.CheckShow();l.goods.blocks.main.sellerId=n.seller.id;l.goods.blocks.main.shopId=n.shop.id;l.goods.SetListMoreBlock("standalone");i(l.goods)},Main:function(n){GoodsMainBlockViewModel.prototype=new Widget();l.goods.AddBlock("main",new GoodsMainBlockViewModel(n,e));if($.inArray("blockDescription",e.showBlocks)>=0){var m="blockDescription";l.goods.AddBlock(m,n.description);if(n.description&&n.description.match(/data-bind/)){l.hasButton=m}}if(e.count&&e.count<=l.goods.blocks.main.count()){l.goods.blocks.main.ordered(e.count)}else{l.goods.blocks.main.count(0)}},Gallery:function(o){var m=[];for(var n=0;n<=o.length-1;n++){m[n]=new GalleryBlockViewModel(o[n])}l.goods.AddBlock("gallery",m)},Seller:function(m){l.goods.sellerInfo.seller=m},Shop:function(m){l.goods.sellerInfo.shop=m},Operator:function(m){l.goods.sellerInfo.operator=m},Block:function(n,p){var q=new MoreBlockViewModel(n);if(n=="shipping"){var m=[];for(var o in p){m.push(new ShippingBlockViewModel(p[o]))}p=m;n="blockShipping"}if(n=="opinion"){n="blockOpinion"}q.AddParams(p);l.goods.AddBlock(n,q)}};function i(m){d();l.RenderTemplate(m,e,function(n){if(l.hasButton){$.each(n.moreBlock,function(p){if(n.moreBlock[p].key==l.hasButton){var o=$("#"+n.moreBlock[p].idBlock+" [data-bind^=click]");$.each(o,function(q){if(n.blocks.main.showAddToCart()){if($(o[q]).attr("data-bind").match(/AddToCart/)){var s=new AddToCartButtonViewModel(n.blocks.main);ko.applyBindings(s,o[q])}}else{$(o[q]).hide()}if(n.blocks.main.showBuy()){if($(o[q]).attr("data-bind").match(/Buy/)){var r=new BuyButtonViewModel(n.blocks.main);ko.applyBindings(r,o[q])}}else{$(o[q]).hide()}})}})}h(n)},function(n){d();i(n)},function(){a()})}function h(o){var m=$.cookie(Config.Base.cookie.previously_viewed);if(!m){$.cookie(Config.Base.cookie.previously_viewed,o.id)}else{var n=m.split(",");var p=$.inArray(o.id,n);if(p>=0){n.splice(p,1);n.unshift(o.id)}else{n.unshift(o.id)}if(n.length>20){n.splice(20,1)}$.cookie(Config.Base.cookie.previously_viewed,n.join(","))}var m=$.cookie(Config.Base.cookie.previously_viewed)}};var StandaloneGoodsViewModel=function(c){var a=this;a.activeButton=c.button.active;a.inactiveButton=c.button.inactive;a.show={blockIdGoods:false,blockShortName:false,blockFullName:false,blockGallery:false,blockShop:false,blockInfoSeller:false,blockOperator:false,blockCount:false,editableCount:false,blockShare:false,blockDescription:false,blockShipping:false,blockOpinion:false};a.ShowGallery=function(){if(a.blocks.gallery){return true}return false};a.CheckShow=function(){for(var e in a.show){b(e)}};a.SetListMoreBlock=function(f){for(var e in c.moreBlocks){if(d(e)){StandaloneGoodsListMoreBlockViewModel.prototype=new GoodsListMoreBlockViewModel(e,a.blocks[e],f,c);a.moreBlock.push(new StandaloneGoodsListMoreBlockViewModel(c))}}};function d(e){return $.inArray(e,c.showBlocks)>=0}a.Buy=function(){var e={idGoods:c.idGoods,count:a.blocks.main.ordered()};if(c.idShopPartner){e.idShopPartner=c.idShopPartner}if(c.mailUser){e.mailUser=c.mailUser}if(c.idMethodPayment){e.idMethodPayment=c.idMethodPayment}Routing.SetHash("standalone_payment","Оплатить товар",e)};function b(e){if($.inArray(e,c.showBlocks)>=0){a.show[e]=true}}};var StandaloneGoodsListMoreBlockViewModel=function(a){this.title=a.moreBlocks[this.key];this.templateName=this.prefix+this.key.charAt(0).toUpperCase()+this.key.substr(1)+"BlockTmpl"};var TestStandaloneGoods={Init:function(){if(typeof Widget=="function"){StandaloneGoodsWidget.prototype=new Widget();var a=new StandaloneGoodsWidget();a.Init(a)}else{setTimeout(function(){TestStandaloneGoods.Init()},100)}}};TestStandaloneGoods.Init();