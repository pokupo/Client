var BreadCrumbWidget=function(){function t(){n(),e(),i(Routing.GetActiveCategory())}function e(){var t=s.GetInputParameters("breadCrumb");$.isEmptyObject(t)||(m=s.UpdateSettings1(m,t)),Config.BreadCrumb=m}function r(t){$("#"+m.container.widget[t]).empty().html("")}function a(){for(var t=m.container.widget,e=0;e<=t.length-1;e++)$("#"+t[e]).length>0&&(r(e),$("#"+t[e]).append($("script#"+s.GetTmplName1(m)).html()).children().hide())}function i(t){Routing.IsDefault()&&s.HasDefaultContent()?s.WidgetLoader(!0):(s.WidgetLoader(!1),s.BaseLoad.Tmpl(m.tmpl,function(){t?s.BaseLoad.Path(t,function(t){o(t)}):s.WidgetLoader(!0)}))}function n(){s.AddEvent("w.change.route",function(){i(Routing.GetActiveCategory())}),s.AddEvent("w.change.breadCrumb",function(t){i(t)}),s.AddEvent("breadCrumb.fill.item",function(t){u(t)}),s.AddEvent("breadCrumb.click.item",function(t){s.BaseLoad.Path(t.id,function(t){Routing.SetHash("catalog",t[t.length-1].name_category,Routing.GetPath(t))})})}function o(t){var e=new BreadCrumbViewModel;e.AddCrumbs(t)}function u(t){a();for(var e=m.container.widget,i=0;i<=e.length-1;i++){if($("#"+e[i]).length>0)try{ko.cleanNode($("#"+e[i])[0]),ko.applyBindings(t,$("#"+e[i])[0]),s.ShowContainer(e[i]),s.WidgetLoader(!0),m.animate&&m.animate()}catch(n){s.Exception("Ошибка шаблона ["+s.GetTmplName1(m)+"]",n),m.tmpl.custom?(delete m.tmpl.custom,s.BaseLoad.Tmpl(m.tmpl,function(){u(t)})):(r(i),s.WidgetLoader(!0))}else s.Exception("Ошибка. Не найден контейнер ["+e[i]+"]"),s.WidgetLoader(!0);delete t}}var s=this;s.widgetName="BreadCrumbWidget",s.version=1,s.minWidgetVersion=1,s.maxWidgetVersion=2,s.minTmplVersion=1,s.maxTmplVersion=2,s.InitWidget=t;var m={container:{widget:["breadCrumbsWidgetId_1"],def:["defaultBreadCrumbsWidgetId_1"]},tmpl:{path:"breadCrumbTmpl.html",id:"breadCrumbTmpl"},animate:"function"==typeof AnimateBreadCrumb?AnimateBreadCrumb:null}},BreadCrumbItem=function(t){var e=this;e.id=t.id,e.title=t.name_category,e.typeCategory=t.type_category,e.selectList=ko.observableArray(),e.showSelectList=ko.computed(function(){return e.selectList()>0?!0:void 0},this),e.ClickItem=function(){e.showSelectList()||EventDispatcher.DispatchEvent("breadCrumb.click.item",{id:e.id})},e.AddSelectList=function(t){for(var r=0;r<=t.length-1;r++)e.selectList.push(new SelectListBreadCrumbItem(t[r]))}},BreadCrumbViewModel=function(){var t=this;t.lastItem=ko.observable(),t.title="",t.crumbs=ko.observableArray(),t.ToHomepage=function(){Routing.SetHash("default","Домашняя",{})},t.showReturn=ko.computed(function(){return Parameters.cache.history.length>1?!0:!1},this),t.Return=function(){Parameters.cache.history.pop();var t=Parameters.cache.history.pop();"order"==t.route&&t.data.create&&(t=Parameters.cache.history.pop()),Routing.SetHash(t.route,t.title,t.data,!0)},t.AddCrumbs=function(e){if(e){for(var r=0;r<=e.length-1;r++){var a=new BreadCrumbItem(e[r]);e[r].children&&a.AddSelectList(e[r].children),t.crumbs.push(a)}if("default"==Routing.route&&(t.crumbs=ko.observableArray(),t.lastItem(Routing.defaultTitle)),"goods"==Routing.route&&t.lastItem("Карточка товара"),"cart"==Routing.route&&(t.crumbs=ko.observableArray(),t.lastItem("Моя корзина")),"payment"==Routing.route&&(t.crumbs=ko.observableArray(),t.lastItem("Оплата заказа")),"registration"==Routing.route&&(t.crumbs=ko.observableArray(),t.crumbs.push(new BreadCrumbItem({id:0,name_category:"Регистрация покупателя"})),1==Routing.params.step&&t.lastItem("Шаг 1"),2==Routing.params.step&&t.lastItem("Шаг 2"),3==Routing.params.step&&t.lastItem("Шаг 3"),4==Routing.params.step&&t.lastItem("Шаг 4")),"order"==Routing.route&&(t.crumbs=ko.observableArray(),t.crumbs.push(new BreadCrumbItem({id:0,name_category:"Оформление заказа"})),1==Routing.params.step&&t.lastItem("Шаг 1"),2==Routing.params.step&&t.lastItem("Шаг 2"),3==Routing.params.step&&t.lastItem("Шаг 3"),4==Routing.params.step&&t.lastItem("Шаг 4"),5==Routing.params.step&&t.lastItem("Шаг 5")),("profile"==Routing.route||"favorites"==Routing.route||"purchases"==Routing.route||"cabinet_cart"==Routing.route)&&(t.crumbs=ko.observableArray(),t.lastItem("Личный кабинет")),!t.lastItem()){var i=t.crumbs().pop();t.lastItem(i.title)}EventDispatcher.DispatchEvent("breadCrumb.fill.item",t)}}},SelectListBreadCrumbItem=function(t){var e=this;e.id=t.id,e.title=t.name_category,e.cssActiveItem=ko.computed(function(){return"catalog"==Routing.route&&e.id==Routing.GetActiveCategory()?"active":""},this),e.ClickItem=function(){EventDispatcher.DispatchEvent("breadCrumb.click.item",{id:e.id})}},TestBreadCrumb={Init:function(){if("function"==typeof Widget){BreadCrumbWidget.prototype=new Widget;var t=new BreadCrumbWidget;t.Init(t)}else setTimeout(function(){TestBreadCrumb.Init()},100)}};TestBreadCrumb.Init();