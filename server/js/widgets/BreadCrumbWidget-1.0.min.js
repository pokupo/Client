var BreadCrumbWidget=function(){var j=this;j.widgetName="BreadCrumbWidget";j.version=1;j.minWidgetVersion=1;j.maxWidgetVersion=2;j.minTmplVersion=1;j.maxTmplVersion=2;j.InitWidget=f;var d={container:{widget:["breadCrumbsWidgetId_1"],def:["defaultBreadCrumbsWidgetId_1"]},tmpl:{path:"breadCrumbTmpl.html",id:"breadCrumbTmpl"},animate:typeof AnimateBreadCrumb=="function"?AnimateBreadCrumb:null};function f(){i();b();g(Routing.GetActiveCategory())}function b(){var k=j.GetInputParameters("breadCrumb");if(!$.isEmptyObject(k)){d=j.UpdateSettings1(d,k)}Config.Containers.breadCrumb=d.container}function a(k){$("#"+d.container.widget[k]).empty().html("")}function h(){var k=d.container.widget;for(var l=0;l<=k.length-1;l++){if($("#"+k[l]).length>0){a(l);$("#"+k[l]).append($("script#"+j.GetTmplName1(d)).html()).children().hide()}}}function g(k){if(Routing.IsDefault()&&j.HasDefaultContent()){j.WidgetLoader(true)}else{j.WidgetLoader(false);j.BaseLoad.Tmpl(d.tmpl,function(){if(k){j.BaseLoad.Path(k,function(l){c(l)})}else{j.WidgetLoader(true)}})}}function i(){j.AddEvent("w.change.route",function(k){g(Routing.GetActiveCategory())});j.AddEvent("w.change.breadCrumb",function(k){g(k)});j.AddEvent("breadCrumb.fill.item",function(k){e(k)});j.AddEvent("breadCrumb.click.item",function(k){j.BaseLoad.Path(k.id,function(l){Routing.SetHash("catalog",l[l.length-1].name_category,Routing.GetPath(l))})})}function c(l){var k=new BreadCrumbViewModel();k.AddCrumbs(l)}function e(m){h();var k=d.container.widget;for(var l=0;l<=k.length-1;l++){if($("#"+k[l]).length>0){try{ko.cleanNode($("#"+k[l])[0]);ko.applyBindings(m,$("#"+k[l])[0]);j.ShowContainer(k[l]);j.WidgetLoader(true);if(d.animate){d.animate()}}catch(n){j.Exception("Ошибка шаблона ["+j.GetTmplName1(d)+"]",n);if(d.tmpl.custom){delete d.tmpl.custom;j.BaseLoad.Tmpl(d.tmpl,function(){e(m)})}else{a(l);j.WidgetLoader(true)}}}else{j.Exception("Ошибка. Не найден контейнер ["+k[l]+"]");j.WidgetLoader(true)}delete m}}};var BreadCrumbItem=function(b){var a=this;a.id=b.id;a.title=b.name_category;a.typeCategory=b.type_category;a.selectList=ko.observableArray();a.showSelectList=ko.computed(function(){if(a.selectList()>0){return true}else{false}},this);a.ClickItem=function(){if(!a.showSelectList()){EventDispatcher.DispatchEvent("breadCrumb.click.item",{id:a.id})}};a.AddSelectList=function(d){for(var c=0;c<=d.length-1;c++){a.selectList.push(new SelectListBreadCrumbItem(d[c]))}}};var BreadCrumbViewModel=function(){var a=this;a.lastItem=ko.observable();a.title="";a.crumbs=ko.observableArray();a.ToHomepage=function(){Routing.SetHash("default","Домашняя",{})};a.showReturn=ko.computed(function(){if(Parameters.cache.history.length>1){return true}return false},this);a.Return=function(){Parameters.cache.history.pop();var b=Parameters.cache.history.pop();if(b.route=="order"&&b.data.create){b=Parameters.cache.history.pop()}Routing.SetHash(b.route,b.title,b.data,true)};a.AddCrumbs=function(e){if(e){for(var b=0;b<=e.length-1;b++){var c=new BreadCrumbItem(e[b]);if(e[b].children){c.AddSelectList(e[b].children)}a.crumbs.push(c)}if(Routing.route=="default"){a.crumbs=ko.observableArray();a.lastItem(Routing.defaultTitle)}if(Routing.route=="goods"){a.lastItem("Карточка товара")}if(Routing.route=="cart"){a.crumbs=ko.observableArray();a.lastItem("Моя корзина")}if(Routing.route=="payment"){a.crumbs=ko.observableArray();a.lastItem("Оплата заказа")}if(Routing.route=="registration"){a.crumbs=ko.observableArray();a.crumbs.push(new BreadCrumbItem({id:0,name_category:"Регистрация покупателя"}));if(Routing.params.step==1){a.lastItem("Шаг 1")}if(Routing.params.step==2){a.lastItem("Шаг 2")}if(Routing.params.step==3){a.lastItem("Шаг 3")}if(Routing.params.step==4){a.lastItem("Шаг 4")}}if(Routing.route=="order"){a.crumbs=ko.observableArray();a.crumbs.push(new BreadCrumbItem({id:0,name_category:"Оформление заказа"}));if(Routing.params.step==1){a.lastItem("Шаг 1")}if(Routing.params.step==2){a.lastItem("Шаг 2")}if(Routing.params.step==3){a.lastItem("Шаг 3")}if(Routing.params.step==4){a.lastItem("Шаг 4")}if(Routing.params.step==5){a.lastItem("Шаг 5")}}if(Routing.route=="profile"||Routing.route=="favorites"||Routing.route=="purchases"||Routing.route=="cabinet_cart"){a.crumbs=ko.observableArray();a.lastItem("Личный кабинет")}if(!a.lastItem()){var d=a.crumbs().pop();a.lastItem(d.title)}EventDispatcher.DispatchEvent("breadCrumb.fill.item",a)}}};var SelectListBreadCrumbItem=function(b){var a=this;a.id=b.id;a.title=b.name_category;a.cssActiveItem=ko.computed(function(){if(Routing.route=="catalog"&&a.id==Routing.GetActiveCategory()){return"active"}return""},this);a.ClickItem=function(){EventDispatcher.DispatchEvent("breadCrumb.click.item",{id:a.id})}};var TestBreadCrumb={Init:function(){if(typeof Widget=="function"){BreadCrumbWidget.prototype=new Widget();var a=new BreadCrumbWidget();a.Init(a)}else{setTimeout(function(){TestBreadCrumb.Init()},100)}}};TestBreadCrumb.Init();