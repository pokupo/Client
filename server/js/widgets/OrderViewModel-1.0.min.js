var OrderViewModel=function(e){var o=this;o.id=ko.observable(),o.showBackList=!0,e&&e.show.hasOwnProperty("menu")&&(o.showBackList=e.show.menu),o.nameMethodShipping=ko.observable(),o.logoMethodShipping=ko.observable(),o.shippingCountry=ko.observable(),o.shippingRegion=ko.observable(),o.shippingCity=ko.observable(),o.shippingPostCode=ko.observable(),o.shippingAddress=ko.observable(),o.shippingAddressee=ko.observable(),o.shippingContactPhone=ko.observable(),o.namePayment=ko.observable(),o.logoPayment=ko.observable(),o.timePayment=ko.observable(),o.descPayment=ko.observable(),o.invoicePayment=ko.observable(),o.dateCreate=ko.observable(),o.commentBuyer=ko.observable();var s=Parameters.cache.userInformation;o.avatar=s.route_icon_user,o.username=s.login,o.commentOperator=ko.observable(),o.realShipping=ko.observable(),o.statusPay=ko.observable(),o.statusOrder=ko.observable(),o.trackNumber=ko.observable(),o.nameShop=ko.observable(),o.nameOwnShop=ko.observable(),o.costShipping=ko.observable("0"),o.costPayment=ko.observable("0"),o.sellCost=ko.observable(),o.finalCost=ko.observable(),o.discount=ko.observable(),o.discountSum=ko.observable(),o.itog=ko.observable(),o.goods=ko.observableArray(),o.AddContent=function(e){var s=e.order;o.id(s.id),s.hasOwnProperty("method_shipping")&&(s.method_shipping.hasOwnProperty("name_method_shipping")&&o.nameMethodShipping(s.method_shipping.name_method_shipping),s.method_shipping.hasOwnProperty("logo_shipping_company")&&o.logoMethodShipping(s.method_shipping.logo_shipping_company)),s.hasOwnProperty("shipping")&&o.realShipping("yes"==s.shipping?!0:!1),s.hasOwnProperty("shipping_address")?(s.shipping_address.hasOwnProperty("country")&&o.shippingCountry(s.shipping_address.country),s.shipping_address.hasOwnProperty("region")&&o.shippingRegion(s.shipping_address.region),s.shipping_address.hasOwnProperty("city")&&o.shippingCity(s.shipping_address.city),s.shipping_address.hasOwnProperty("post_code")&&o.shippingPostCode(s.shipping_address.post_code),s.shipping_address.hasOwnProperty("address")&&o.shippingAddress(s.shipping_address.address),s.shipping_address.hasOwnProperty("addressee")&&o.shippingAddressee(s.shipping_address.addressee),s.shipping_address.hasOwnProperty("contact_phone")&&o.shippingContactPhone(s.shipping_address.contact_phone)):o.realShipping(!1),s.hasOwnProperty("method_payment")&&(s.method_payment.hasOwnProperty("name_payment")&&o.namePayment(s.method_payment.name_payment),s.method_payment.hasOwnProperty("logo_payment")&&o.logoPayment(s.method_payment.logo_payment),s.method_payment.hasOwnProperty("time_payment")&&o.timePayment(s.method_payment.time_payment),s.method_payment.hasOwnProperty("desc_payment")&&o.descPayment(s.method_payment.desc_payment)),s.hasOwnProperty("invoice_payment")&&o.invoicePayment(s.invoice_payment),s.hasOwnProperty("date_create")&&o.dateCreate(s.date_create),s.hasOwnProperty("comment_buyer")&&o.commentBuyer(s.comment_buyer),s.hasOwnProperty("comment_operator")&&o.commentOperator(s.comment_operator),s.hasOwnProperty("status_pay")&&o.statusPay(s.status_pay),s.hasOwnProperty("status_order")&&o.statusOrder(s.status_order),s.hasOwnProperty("track_number")&&o.trackNumber(s.track_number),s.hasOwnProperty("name_shop")&&o.nameShop(s.name_shop),s.hasOwnProperty("name_own_shop")&&o.nameOwnShop(s.name_own_shop);var a=0;s.hasOwnProperty("cost_shipping")&&(o.costShipping(s.cost_shipping),a=s.cost_shipping),s.hasOwnProperty("cost_payment")&&(o.costPayment(s.cost_payment),a+=s.cost_payment),s.hasOwnProperty("sell_cost")&&o.sellCost(s.sell_cost),s.hasOwnProperty("final_cost")&&(o.finalCost(s.final_cost),a+=s.final_cost),a=Math.round(100*a)/100,o.itog(a),o.goods=ko.observableArray();var t=0,n=0;$.each(e.goods,function(s){o.goods.push(new OrderGoodsViewModel(e.goods[s])),t+=e.goods[s].sell_cost,n+=e.goods[s].final_cost});var r=t-n,i=Math.floor(100*r/t),p=0;i>0&&(p=i+"%"),o.discount=ko.observable(p),o.discountSum=ko.observable(r),o.ClickConfirm=function(){EventDispatcher.DispatchEvent("Order.step5.confirm",{comment:o.commentBuyer()})},o.ClickRefresh=function(){Routing.SetHash("purchases","Мои покупки",{block:"detail",id:o.id()})}}},OrderGoodsViewModel=function(e){var o=this;o.id=e.id,o.fullName=e.full_name,o.sellCost=e.sell_cost,o.itogSellCost=(e.sell_cost*e.count).toFixed(2),o.finalCost=e.final_cost,o.count=e.count,o.routeImage=e.route_image,o.routeBigImage=e.route_big_image,o.isEgoods="yes"==e.is_egoods?!0:!1,o.isEgoodsPaid=ko.computed(function(){return e.hasOwnProperty("egoods")?!0:!1},this),o.isEgoodsPaid()&&(o.EGoods=ko.observableArray(),$.each(e.egoods,function(s){o.EGoods.push(new OrderEGoodsViewModel(e.egoods[s]))})),o.ClickGoods=function(){Routing.SetHash("goods",o.chortName,{id:o.id})}},OrderEGoodsViewModel=function(e){var o=this;o.uploadFile=e.upload_file,o.sizeFile=e.size_file,o.countUpload=e.count_upload,o.expiration=null,e.expiration&&(o.expiration=e.expiration),o.maxUpload=e.max_upload?e.max_upload:"∞"};