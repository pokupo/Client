var OrderViewModel=function(c){var b=this;b.id=ko.observable();b.showBackList=true;if(c&&c.show.hasOwnProperty("menu")){b.showBackList=c.show.menu}b.nameMethodShipping=ko.observable();b.logoMethodShipping=ko.observable();b.shippingCountry=ko.observable();b.shippingRegion=ko.observable();b.shippingCity=ko.observable();b.shippingPostCode=ko.observable();b.shippingAddress=ko.observable();b.shippingAddressee=ko.observable();b.shippingContactPhone=ko.observable();b.namePayment=ko.observable();b.logoPayment=ko.observable();b.timePayment=ko.observable();b.descPayment=ko.observable();b.invoicePayment=ko.observable();b.dateCreate=ko.observable();b.commentBuyer=ko.observable();var a=Parameters.cache.userInformation;b.avatar=a.route_icon_user;b.username=a.login;b.commentOperator=ko.observable();b.realShipping=ko.observable();b.statusPay=ko.observable();b.statusOrder=ko.observable();b.trackNumber=ko.observable();b.nameShop=ko.observable();b.nameOwnShop=ko.observable();b.costShipping=ko.observable("0");b.costPayment=ko.observable("0");b.sellCost=ko.observable();b.finalCost=ko.observable();b.discount=ko.observable();b.discountSum=ko.observable();b.itog=ko.observable();b.goods=ko.observableArray();b.AddContent=function(h){var e=h.order;b.id(e.id);if(e.hasOwnProperty("method_shipping")){if(e.method_shipping.hasOwnProperty("name_method_shipping")){b.nameMethodShipping(e.method_shipping.name_method_shipping)}if(e.method_shipping.hasOwnProperty("logo_shipping_company")){b.logoMethodShipping(e.method_shipping.logo_shipping_company)}}if(e.hasOwnProperty("shipping")){if(e.shipping=="yes"){b.realShipping(true)}else{b.realShipping(false)}}if(e.hasOwnProperty("shipping_address")){if(e.shipping_address.hasOwnProperty("country")){b.shippingCountry(e.shipping_address.country)}if(e.shipping_address.hasOwnProperty("region")){b.shippingRegion(e.shipping_address.region)}if(e.shipping_address.hasOwnProperty("city")){b.shippingCity(e.shipping_address.city)}if(e.shipping_address.hasOwnProperty("post_code")){b.shippingPostCode(e.shipping_address.post_code)}if(e.shipping_address.hasOwnProperty("address")){b.shippingAddress(e.shipping_address.address)}if(e.shipping_address.hasOwnProperty("addressee")){b.shippingAddressee(e.shipping_address.addressee)}if(e.shipping_address.hasOwnProperty("contact_phone")){b.shippingContactPhone(e.shipping_address.contact_phone)}}else{b.realShipping(false)}if(e.hasOwnProperty("method_payment")){if(e.method_payment.hasOwnProperty("name_payment")){b.namePayment(e.method_payment.name_payment)}if(e.method_payment.hasOwnProperty("logo_payment")){b.logoPayment(e.method_payment.logo_payment)}if(e.method_payment.hasOwnProperty("time_payment")){b.timePayment(e.method_payment.time_payment)}if(e.method_payment.hasOwnProperty("desc_payment")){b.descPayment(e.method_payment.desc_payment)}}if(e.hasOwnProperty("invoice_payment")){b.invoicePayment(e.invoice_payment)}if(e.hasOwnProperty("date_create")){b.dateCreate(e.date_create)}if(e.hasOwnProperty("comment_buyer")){b.commentBuyer(e.comment_buyer)}if(e.hasOwnProperty("comment_operator")){b.commentOperator(e.comment_operator)}if(e.hasOwnProperty("status_pay")){b.statusPay(e.status_pay)}if(e.hasOwnProperty("status_order")){b.statusOrder(e.status_order)}if(e.hasOwnProperty("track_number")){b.trackNumber(e.track_number)}if(e.hasOwnProperty("name_shop")){b.nameShop(e.name_shop)}if(e.hasOwnProperty("name_own_shop")){b.nameOwnShop(e.name_own_shop)}var l=0;if(e.hasOwnProperty("cost_shipping")){b.costShipping(e.cost_shipping);l=e.cost_shipping}if(e.hasOwnProperty("cost_payment")){b.costPayment(e.cost_payment);l=l+e.cost_payment}if(e.hasOwnProperty("sell_cost")){b.sellCost(e.sell_cost)}if(e.hasOwnProperty("final_cost")){b.finalCost(e.final_cost);l=l+e.final_cost}l=Math.round(l*100)/100;b.itog(l);b.goods=ko.observableArray();var g=0;var f=0;$.each(h.goods,function(d){b.goods.push(new OrderGoodsViewModel(h.goods[d]));g=g+h.goods[d].sell_cost;f=f+h.goods[d].final_cost});var i=g-f;var j=Math.floor(i*100/g);var k=0;if(j>0){k=j+"%"}b.discount=ko.observable(k);b.discountSum=ko.observable(i);b.ClickConfirm=function(){EventDispatcher.DispatchEvent("Order.step5.confirm",{comment:b.commentBuyer()})};b.ClickRefresh=function(){Routing.SetHash("purchases","Мои покупки",{block:"detail",id:b.id()})}}};var OrderGoodsViewModel=function(b){var a=this;a.id=b.id;a.fullName=b.full_name;a.sellCost=b.sell_cost;a.itogSellCost=(b.sell_cost*b.count).toFixed(2);a.finalCost=b.final_cost;a.count=b.count;a.routeImage=b.route_image;a.routeBigImage=b.route_big_image;if(b.is_egoods=="yes"){a.isEgoods=true}else{a.isEgoods=false}a.isEgoodsPaid=ko.computed(function(){if(b.hasOwnProperty("egoods")){return true}return false},this);if(a.isEgoodsPaid()){a.EGoods=ko.observableArray();$.each(b.egoods,function(c){a.EGoods.push(new OrderEGoodsViewModel(b.egoods[c]))})}a.ClickGoods=function(){Routing.SetHash("goods",a.chortName,{id:a.id})}};var OrderEGoodsViewModel=function(b){var a=this;a.uploadFile=b.upload_file;a.sizeFile=b.size_file;a.countUpload=b.count_upload;a.expiration=null;if(b.expiration){a.expiration=b.expiration}a.maxUpload=b.max_upload?b.max_upload:"∞"};