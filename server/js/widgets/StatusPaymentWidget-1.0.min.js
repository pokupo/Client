var StatusPaymentWidget=function(){function t(){c.container=Config.Containers.statusPayment.widget,c.customContainer=Config.Containers.statusPayment.customClass,c.tmpl=Config.StatusPayment.tmpl,o(),i(),e()}function e(){var t={};if("string"==Config.Base.sourceParameters){var e=JSCore.ParserInputParameters(/StatusPaymentWidget/);e.statusPayment&&(t=e.statusPayment)}"object"==Config.Base.sourceParameters&&"undefined"!=typeof WParameters&&WParameters.statusPayment&&(t=WParameters.statusPayment),JSSettings.dev&&Logger.Console.VarDump(u.widgetName,"Input parameters",t),$.isEmptyObject(t)||(t.tmpl&&(t.tmpl.path&&(c.tmpl.path=t.tmpl.path),t.tmpl.id&&(c.tmpl.id=t.tmpl.id)),t.animate&&(c.animate=t.animate),t.backUrl&&(c.backUrl=t.backUrl)),JSSettings.dev&&Logger.Console.VarDump(u.widgetName,"Result settings",c),u.settings=c}function a(){var t=$("#"+c.container).find(u.SelectCustomContent().join(", ")).clone();$("#"+c.container).empty().html(t)}function n(){a(),$("#"+c.container).append($("script#"+u.GetTmplName()).html()).children().hide()}function i(){if("status_payment"==Routing.route){var t=$.cookie(Config.Base.cookie.orderId),e=$.cookie(Config.Base.cookie.userEmail);if(t){var a=Routing.GetParameter("name"),n=Routing.GetParameter("status");n&&(a=a+"/"+n);var i=a+"/?"+t+"&mailUser="+e;u.BaseLoad.Tmpl(c.tmpl,function(){u.BaseLoad.StatusPayment(i,function(t){u.BaseLoad.ShopInfo(function(e){s(t,e)})})})}else u.WidgetLoader(!0,c.container),alert("Нет параметров инициализации!")}else u.WidgetLoader(!0,c.container)}function o(){EventDispatcher.AddEventListener("w.change.route",function(){i()}),EventDispatcher.AddEventListener("StatusPaymentWidget.update",function(){i()})}function s(t,e){var a=new StatusPaymentViewModel(t,e,c);n(),r(a)}function r(t){if($("#"+c.container).length>0)try{ko.cleanNode($("#"+c.container)[0]),ko.applyBindings(t,$("#"+c.container)[0]),u.WidgetLoader(!0,c.container),"function"==typeof AnimateStatusPayment&&new AnimateStatusPayment,c.animate&&c.animate()}catch(e){u.Exception("Ошибка шаблона ["+u.GetTmplName()+"]",e),c.tmpl.custom?(delete c.tmpl.custom,u.BaseLoad.Tmpl(c.tmpl,function(){n(),r(t)})):(a(),u.WidgetLoader(!0,c.container))}else u.Exception("Ошибка. Не найден контейнер ["+c.container+"]"),u.WidgetLoader(!0,c.container)}var u=this;u.widgetName="StatusPaymentWidget",u.version=1,u.minWidgetVersion=1,u.maxWidgetVersion=2,u.minTmplVersion=1,u.maxTmplVersion=2,u.InitWidget=t;var c={container:null,customContainer:null,tmpl:{path:null,id:null},status:null,backUrl:""}},StatusPaymentViewModel=function(t,e,a){function n(t){var e=this;e.label=ko.observable(t.label),e.value=ko.observable(t.value),e.help=ko.observable(t.help)}var i=this;i.orderId=t.id_order,i.instruction=t.instruction,i.cssOrder="order_print_block",i.status=t.status,i.isPaid=ko.observable(!1),"paid"==i.status&&i.isPaid(!0),i.isWait=ko.observable(!1),"wait_pay"==i.status&&i.isWait(!0),i.isCancel=ko.observable(!1),"cancel"==i.status&&i.isCancel(!0),i.isBack=ko.observable(!1),"back"==i.status&&i.isBack(!0),i.outData=ko.observableArray(),$.each(t.out_data,function(e){i.outData.push(new n(t.out_data[e]))}),i.egoods=[],t.egoods&&($.each(t.egoods,function(e){t.egoods[e].max_upload||(t.egoods[e].max_upload=!1),t.egoods[e].expiration||(t.egoods[e].expiration=!1)}),i.egoods=t.egoods),i.Print=function(t){var e=window.open();e.document.write($("#"+t).html()),e.print(),e.close()},i.ClickPrintOrder=function(){i.Print(i.cssOrder)},i.ClickBack=function(){var t=e.site_shop;a.backUrl&&(t=a.backUrl),window.location.href=t},i.ClickRefresh=function(){EventDispatcher.DispatchEvent("StatusPaymentWidget.update")},i.showRefresh=!1,"success"==Routing.GetParameter("status")&&"wait_pay"==i.status&&(i.showRefresh=!0)},TestStatusPayment={Init:function(){if("function"==typeof Widget){StatusPaymentWidget.prototype=new Widget;var t=new StatusPaymentWidget;t.Init(t)}else setTimeout(function(){TestStatusPayment.Init()},100)}};TestStatusPayment.Init();