var StatusPaymentWidget=function(){var j=this;j.widgetName="StatusPaymentWidget";j.version=1;j.minWidgetVersion=1;j.maxWidgetVersion=2;j.minTmplVersion=1;j.maxTmplVersion=2;j.InitWidget=h;var e={container:{widget:"content",def:"defaultStatusPaymentWidgetId"},tmpl:{path:"statusPaymentTmpl.html",id:"statusPaymentPageTmpl"},animate:typeof AnimateStatusPayment=="function"?AnimateStatusPayment:null,status:null,backUrl:""};function h(){b();i();f()}function b(){var k=j.GetInputParameters("statusPayment");if(!$.isEmptyObject(k)){e=j.UpdateSettings1(e,k)}Config.Containers.statusPayment=e.container}function a(){j.ClearContainer(e)}function c(){j.InsertContainer(e)}function f(){if(Routing.route=="status_payment"){var k=$.cookie(Config.Base.cookie.orderId);var m=$.cookie(Config.Base.cookie.userEmail);if(k){var n=Routing.GetParameter("name");var l=Routing.GetParameter("status");if(l){n=n+"/"+l}var o=n+"/?"+k+"&mailUser="+m;j.BaseLoad.Tmpl(e.tmpl,function(){j.BaseLoad.StatusPayment(o,function(p){j.BaseLoad.ShopInfo(function(q){d(p,q)})})})}else{j.WidgetLoader(true,e.container.widget);alert("Нет параметров инициализации!")}}else{j.WidgetLoader(true,e.container.widget)}}function i(){j.AddEvent("w.change.route",function(k){f()});j.AddEvent("StatusPaymentWidget.update",function(k){f()})}function d(k,m){var l=new StatusPaymentViewModel(k,m,e);c();g(l)}function g(k){j.RenderTemplate(k,e,null,function(l){c();g(l)},function(){a()})}};var StatusPaymentViewModel=function(d,e,c){var b=this;b.orderId=d.id_order;b.instruction=d.instruction;b.cssOrder="order_print_block";b.status=d.status;b.isPaid=ko.observable(false);if(b.status=="paid"){b.isPaid(true)}b.isWait=ko.observable(false);if(b.status=="wait_pay"){b.isWait(true)}b.isCancel=ko.observable(false);if(b.status=="cancel"){b.isCancel(true)}b.isBack=ko.observable(false);if(b.status=="back"){b.isBack(true)}b.outData=ko.observableArray();$.each(d.out_data,function(f){b.outData.push(new a(d.out_data[f]))});b.egoods=[];if(d.egoods){$.each(d.egoods,function(f){if(!d.egoods[f]["max_upload"]){d.egoods[f]["max_upload"]=false}if(!d.egoods[f]["expiration"]){d.egoods[f]["expiration"]=false}});b.egoods=d.egoods}b.Print=function(g){var f=window.open();f.document.write($("#"+g).html());f.print();f.close()};b.ClickPrintOrder=function(){b.Print(b.cssOrder)};b.ClickBack=function(){var f=e.site_shop;if(c.backUrl){f=c.backUrl}window.location.href=f};b.ClickRefresh=function(){EventDispatcher.DispatchEvent("StatusPaymentWidget.update")};b.showRefresh=false;if(Routing.GetParameter("status")=="success"&&b.status=="wait_pay"){b.showRefresh=true}function a(g){var f=this;f.label=ko.observable(g.label);f.value=ko.observable(g.value);f.help=ko.observable(g.help)}};var TestStatusPayment={Init:function(){if(typeof Widget=="function"){StatusPaymentWidget.prototype=new Widget();var a=new StatusPaymentWidget();a.Init(a)}else{setTimeout(function(){TestStatusPayment.Init()},100)}}};TestStatusPayment.Init();