var MenuPersonalCabinetWidget=function(){var k=this;k.widgetName="MenuPersonalCabinetWidget";k.version=1.1;k.minWidgetVersion=1;k.maxWidgetVersion=2;k.minTmplVersion=1;k.maxTmplVersion=2;k.active=null;k.subMenu=[];k.InitWidget=h;k.AddMenu=i;k.CheckRouteMenuProfile=b;var f={container:{widget:"menuPersonalCabinetWidgetId",def:"defaultMenuPersonalCabinetWidgetId"},showCart:true,showRegSeller:true,tmpl:{path:"menuPersonalCabinetTmpl.html",id:"menuPersonalCabinetTmpl"},animate:typeof AnimateMenuPersonalCabinet=="function"?AnimateMenuPersonalCabinet:null};function h(){j();c()}function c(){var l=k.GetInputParameters("menuPersonalCabinet");if(!$.isEmptyObject(l)){f=k.UpdateSettings1(f,l)}Config.Containers.menuPersonalCabinet=f.container}function i(l){if(l){k.active=l.active;k.subMenu=l.menu}}function b(){var l=Routing.route;if(l=="profile"||l=="favorites"||l=="cabinet_cart"||l=="purchases"||l=="messages"){k.BaseLoad.Tmpl(f.tmpl,function(){d();e()})}else{$("#"+f.container.widget).empty();k.WidgetLoader(true)}}function j(){k.AddEvent("w.change.route",function(){var l=Routing.route;if(l!="profile"&&l!="favorites"&&l!="cabinet_cart"&&l!="purchases"&&l!="messages"){$("#"+f.container.widget).empty();k.WidgetLoader(true)}if(l=="cabinet_cart"&&!f.showCart){$("#"+f.container.widget).empty();k.WidgetLoader(true)}})}function a(){k.ClearContainer(f)}function d(){k.InsertContainer(f)}function e(){k.BaseLoad.MessageCountUnread(function(l){Parameters.cache.message.countNewMessage(parseInt(l.count_unread_topic));var m=new MenuPersonalCabinetViewModel(k);m.AddSubMenu(k.subMenu,k.active);g(m)})}function g(l){k.RenderTemplate(l,f,null,function(m){d();g(m)},function(){a()})}};var MenuPersonalCabinetViewModel=function(e){var d=this,c=Parameters.cache.userInformation,b=Routing.route;d.subMenu=ko.observableArray();d.avatar=c?c.route_icon_user:"";d.username=c?c.login:"";d.countNewMessage=ko.computed(function(){return Parameters.cache.message.countNewMessage()},this);d.AddSubMenu=function(f,h){d.subMenu=ko.observableArray();for(var g in f){d.subMenu.push(new SubMenuViewModel(f[g],h))}};d.activeProfile=ko.computed(function(){if(b=="profile"){return"active"}return""},this);d.ClickProfile=function(){a("profile","Личный кабинет",{})};d.activePurchases=ko.computed(function(){if(b=="purchases"){return"active"}return""},this);d.ClickPurchases=function(){a("purchases","Мои покупки",{block:"list"})};d.activeAuction=ko.computed(function(){if(b=="auction"){return"active"}return""},this);d.ClickAuction=function(){};d.activeFavorites=ko.computed(function(){if(b=="favorites"){return"active"}return""},this);d.ClickFavorites=function(){a("favorites","Избранное",{})};d.showCart=e.settings.showCart;d.activeCart=ko.computed(function(){if(b=="cabinet_cart"){return"active"}return""},this);d.ClickCart=function(){a("cabinet_cart","Корзина",{})};d.activeMessages=ko.computed(function(){if(b=="messages"){return"active"}return""},this);d.ClickMessages=function(){a("messages","Сообщения",{})};d.ClickBecomeSeller=function(){window.location.href="https://"+window.location.hostname+"/seller/register"};d.showRegSeller=e.settings.showRegSeller;d.ClickRegistrationSeller=function(){a("registration_seller","Стать продавцом",{})};function a(f,h,g){Routing.SetHash(f,h,g)}};var SubMenuViewModel=function(b,c){var a=this;a.title=b.title;a.isActive=ko.computed(function(){if(c==b.prefix){return true}return false});a.activeSubMenu=ko.computed(function(){if(c==b.prefix){return"active"}return""},this);a.ClickSubMenu=function(){Routing.SetHash(Routing.route,a.title,{info:b.prefix})}};