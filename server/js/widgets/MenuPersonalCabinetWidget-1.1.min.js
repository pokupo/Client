var MenuPersonalCabinetWidget=function(){function e(){o(),t()}function t(){var e=c.GetInputParameters("menuPersonalCabinet");$.isEmptyObject(e)||(l=c.UpdateSettings1(l,e)),Config.MenuPersonalCabinet=l}function n(e){e&&(c.active=e.active,c.subMenu=e.menu)}function i(){var e=Routing.route;"profile"==e||"favorites"==e||"cabinet_cart"==e||"purchases"==e||"messages"==e?c.BaseLoad.Tmpl(l.tmpl,function(){r(),u()}):($("#"+l.container.widget).empty(),c.WidgetLoader(!0))}function o(){c.AddEvent("w.change.route",function(){var e=Routing.route;"profile"!=e&&"favorites"!=e&&"cabinet_cart"!=e&&"purchases"!=e&&"messages"!=e&&($("#"+l.container.widget).empty(),c.WidgetLoader(!0)),"cabinet_cart"!=e||l.showCart||($("#"+l.container.widget).empty(),c.WidgetLoader(!0))})}function a(){c.ClearContainer(l)}function r(){c.InsertContainer(l)}function u(){c.BaseLoad.MessageCountUnread(function(e){Parameters.cache.message.countNewMessage(parseInt(e.count_unread_topic));var t=new MenuPersonalCabinetViewModel(c);t.AddSubMenu(c.subMenu,c.active),s(t)})}function s(e){c.RenderTemplate(e,l,null,function(e){r(),s(e)},function(){a()})}var c=this;c.widgetName="MenuPersonalCabinetWidget",c.version=1.1,c.minWidgetVersion=1,c.maxWidgetVersion=2,c.minTmplVersion=1,c.maxTmplVersion=2,c.active=null,c.subMenu=[],c.InitWidget=e,c.AddMenu=n,c.CheckRouteMenuProfile=i;var l={container:{widget:"menuPersonalCabinetWidgetId",def:"defaultMenuPersonalCabinetWidgetId"},showCart:!0,showRegSeller:!0,tmpl:{path:"menuPersonalCabinetTmpl.html",id:"menuPersonalCabinetTmpl"},animate:"function"==typeof AnimateMenuPersonalCabinet?AnimateMenuPersonalCabinet:null}},MenuPersonalCabinetViewModel=function(e){function t(e,t,n){Routing.SetHash(e,t,n)}var n=this,i=Parameters.cache.userInformation,o=Routing.route;n.subMenu=ko.observableArray(),n.avatar=i?i.route_icon_user:"",n.username=i?i.login:"",n.countNewMessage=ko.computed(function(){return Parameters.cache.message.countNewMessage()},this),n.AddSubMenu=function(e,t){n.subMenu=ko.observableArray();for(var i in e)n.subMenu.push(new SubMenuViewModel(e[i],t))},n.activeProfile=ko.computed(function(){return"profile"==o?"active":""},this),n.ClickProfile=function(){t("profile","Личный кабинет",{})},n.activePurchases=ko.computed(function(){return"purchases"==o?"active":""},this),n.ClickPurchases=function(){t("purchases","Мои покупки",{block:"list"})},n.activeAuction=ko.computed(function(){return"auction"==o?"active":""},this),n.ClickAuction=function(){},n.activeFavorites=ko.computed(function(){return"favorites"==o?"active":""},this),n.ClickFavorites=function(){t("favorites","Избранное",{})},n.showCart=e.settings.showCart,n.activeCart=ko.computed(function(){return"cabinet_cart"==o?"active":""},this),n.ClickCart=function(){t("cabinet_cart","Корзина",{})},n.activeMessages=ko.computed(function(){return"messages"==o?"active":""},this),n.ClickMessages=function(){t("messages","Сообщения",{})},n.ClickBecomeSeller=function(){window.location.href="https://"+window.location.hostname+"/seller/register"},n.showRegSeller=e.settings.showRegSeller,n.ClickRegistrationSeller=function(){t("registration_seller","Стать продавцом",{})}},SubMenuViewModel=function(e,t){var n=this;n.title=e.title,n.isActive=ko.computed(function(){return t==e.prefix?!0:!1}),n.activeSubMenu=ko.computed(function(){return t==e.prefix?"active":""},this),n.ClickSubMenu=function(){Routing.SetHash(Routing.route,n.title,{info:e.prefix})}};