var GoodsViewModel=function(b){var a=this;a.id=Routing.params.id;a.blocks={};a.sellerInfo={};a.cssBlockGallery=b.galleryId;a.moreBlock=[];a.ShowGallery=function(){if($.inArray("gallery",b.showBlocks)>=0&&a.blocks.gallery){return true}return false};a.AddBlock=function(c,d){this.blocks[c]=d};a.SetListMoreBlock=function(d){for(var c in b.moreBlocks){if($.inArray(c,b.showBlocks)>=0){a.moreBlock.push(new GoodsListMoreBlockViewModel(c,a.blocks[c],d,b))}}}};var GoodsListMoreBlockViewModel=function(b,e,d,c){var a=this;a.prefix="goods";if(d){a.prefix=d+"Goods"}a.key=b;a.title=c.moreBlocks[b];a.content=e?e:null;a.classTabs=a.prefix+"Tabs";a.classBlocks=a.prefix+"Blocks";a.idTab=b+"Tab";a.idBlock=b+"Block";a.templateName=a.prefix+a.key.charAt(0).toUpperCase()+a.key.substr(1).toLowerCase()+"BlockTmpl";a.ClickLinck=function(){$("."+a.classBlocks).hide();$("#"+a.idBlock).show();$("."+a.classTabs).removeClass("active");$("#"+a.idTab).addClass("active")}};var GoodsMainBlockViewModel=function(c,b){var a=this;a.id=c.id;a.sellerId=0;a.shopId=0;a.chortName=c.chort_name;a.fullName=c.full_name;a.description=c.description;a.weight=c.weight;a.count=ko.observable(c.count);if(c.count_reserve){if(c.count>c.count_reserve){a.count(c.count-c.count_reserve)}else{a.count(0)}}a.isEgoods=ko.computed(function(){if(c.is_egoods=="yes"){return true}return false},this);a.inStock=ko.computed(function(){if(a.isEgoods()&&a.count()&&a.count()!=0){return"Есть"}else{if(a.count()&&a.count()!=0){if(a.count()>=1){return"Да"}}else{return"Нет"}}},this);a.sellCost=c.sell_cost;a.keyWords=c.key_words;a.ratingGoods=c.rating_goods;a.sellEndCost=c.sell_end_cost;a.discount=ko.computed(function(){var e=Math.floor((a.sellCost-a.sellEndCost)*100/a.sellCost);if(e>0){return e+"%"}else{return""}},this);a.routeImages=c.route_image;a.routeBigImages=c.route_big_image;a.idAuction=c.id_auction;a.auctionPrice=c.last_cost;a.nameGroupUser=ko.computed(function(){if(c.name_group_user){return c.name_group_user}return null},this);a.ordered=ko.observable(0);if(a.count()>0||a.isEgoods()){a.ordered(1)}a.cart=ko.observable(Parameters.cache.cart);a.uniq=EventDispatcher.GetUUID();a.cssToCart="goodsToCart_"+a.uniq;a.cssTitleToCart="goodsTilteToCart_"+a.uniq;a.cssShareBlock="share";a.Login=function(){Parameters.cache.lastPage=Parameters.cache.history[Parameters.cache.history.length-1];Routing.SetHash("login","Авторизация пользователя",{})};a.Registration=function(){Parameters.cache.lastPage=Parameters.cache.history[Parameters.cache.history.length-1];Routing.SetHash("registration","Регистрация пользователя",{step:1})};a.showSelectionCount=ko.computed(function(){if($.inArray("selectionCount",b.showBlocks)>=0&&a.count()&&a.count()!=0){return true}return false},this);a.ClickPlus=function(){if(a.ordered()<a.count()){a.ordered(a.ordered()+1)}else{a.ShowMessage(b.message.maxIsReached,false,false)}};a.ClickMinus=function(){if(a.ordered()>0){a.ordered(a.ordered()-1)}};a.showAddToCart=ko.computed(function(){if($.inArray("addToCart",b.showBlocks)>=0&&a.count()!=0){return true}return false},this);a.AddToCart=function(d){Parameters.cache.cart=a.ordered();a.cart(a.cart()+a.ordered());EventDispatcher.DispatchEvent("w.cart.add",{goodsId:a.id,sellerId:a.shopId,count:a.ordered(),hash:a.uniq})};a.showBuy=ko.computed(function(){if($.inArray("buy",b.showBlocks)>=0&&a.count()!=0){return true}return false},this);a.Buy=function(){if(Parameters.cache.userInformation==null||(Parameters.cache.userInformation!=null&&Parameters.cache.userInformation.err)){Parameters.cache.lastPage={route:"order",title:"Оформление заказа",data:{create:"directly",sellerId:a.shopId,goodsId:a.id,count:a.ordered()}};Routing.SetHash("login","Авторизация пользователя",{})}else{Routing.SetHash("order","Оформление заказа",{create:"directly",sellerId:a.shopId,goodsId:a.id,count:a.ordered()})}};a.ReportAvailability=function(){};a.showFavorites=ko.computed(function(){if($.inArray("favorites",b.showBlocks)>=0&&a.count()!=0){return true}return false},this);a.ToCart=function(){Parameters.cache.lastPage=Parameters.cache.history[Parameters.cache.history.length-1];Routing.SetHash("cart",Config.CartGoods.title,{})};a.BidOnAuction=function(){};a.AddFavorites=function(){if(Parameters.cache.userInformation!=null&&!Parameters.cache.userInformation.err){a.AddCommentForm()}else{a.ShowError(Config.Authentication.message.pleaseLogIn,false,false)}};a.comment=ko.observable("");a.AddCommentForm=function(){a.comment(" ");this.ShowCommentForm(a.comment(),function(d){a.comment(d);EventDispatcher.DispatchEvent("w.fav.add",{goodsId:a.id,comment:a.comment(),data:a})})};a.IsFavorite=ko.observable();if($.inArray(a.id,Parameters.cache.favorite)>=0){a.IsFavorite(true)}else{a.IsFavorite(false)}a.ClickFavorites=function(){Routing.SetHash("favorites","Избранное",{})};a.Gift=function(){};a.Remove=function(){}};var GalleryBlockViewModel=function(b){var a=this;a.id=b.id;a.title=b.name_photo;a.thumb=b.route_photo;a.image=b.route_big_photo};var ShippingBlockViewModel=function(b){var a=this;a.id=b.id;a.nameMethodShipping=b.name_method_shipping;a.descMethodShipping=b.desc_method_shipping;a.costShipping=ko.computed(function(){if(b.cost_shipping){return b.cost_shipping}return null},this)};var MoreBlockViewModel=function(b){var a=this;a.key=b;a.params=[];a.AddParams=function(d){for(var c in d){a.params.push(d[c])}}};var BuyButtonViewModel=function(b){var a=this;a.showBuy=ko.computed(function(){if(b.showAddToCart()){return true}return false},this);a.Buy=function(){Routing.SetHash("order","Оформление заказа",{create:"directly",sellerId:b.shopId,goodsId:b.id,count:b.ordered()})}};var AddToCartButtonViewModel=function(b){var a=this;a.showAddToCart=ko.computed(function(){if(b.showBuy()){return true}return false},this);a.AddToCart=function(c){Parameters.cache.cart=b.ordered();b.cart(b.cart()+b.ordered());EventDispatcher.DispatchEvent("w.cart.add",{goodsId:b.id,sellerId:b.sellerId,count:b.ordered(),hash:b.uniq})}};