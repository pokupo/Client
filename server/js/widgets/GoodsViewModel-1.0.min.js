var GoodsViewModel=function(){var o=this;o.id=Routing.params.id,o.blocks={},o.sellerInfo={},o.cssBlockGallery=Config.Goods.galleryId,o.moreBlock=[],o.ShowGallery=function(){return $.inArray("gallery",Config.Goods.showBlocks)>=0&&o.blocks.gallery?!0:!1},o.AddBlock=function(o,e){this.blocks[o]=e},o.SetListMoreBlock=function(e){for(var t in Config.Goods.moreBlocks)$.inArray(t,Config.Goods.showBlocks)>=0&&o.moreBlock.push(new GoodsListMoreBlockViewModel(t,o.blocks[t],e))}},GoodsListMoreBlockViewModel=function(o,e,t){var r=this;r.prefix="goods",t&&(r.prefix=t+"Goods"),r.key=o,r.title=Config.Goods.moreBlocks[o],r.content=e?e:null,r.classTabs=r.prefix+"Tabs",r.classBlocks=r.prefix+"Blocks",r.idTab=o+"Tab",r.idBlock=o+"Block",r.templateName=r.prefix+r.key.charAt(0).toUpperCase()+r.key.substr(1).toLowerCase()+"BlockTmpl",r.ClickLinck=function(){$("."+r.classBlocks).hide(),$("#"+r.idBlock).show(),$("."+r.classTabs).removeClass("active"),$("#"+r.idTab).addClass("active")}},GoodsMainBlockViewModel=function(o){var e=this;e.id=o.id,e.sellerId=0,e.shopId=0,e.chortName=o.chort_name,e.fullName=o.full_name,e.description=o.description,e.weight=o.weight,e.count=ko.observable(o.count),o.count_reserve&&e.count(o.count>o.count_reserve?o.count-o.count_reserve:0),e.isEgoods=ko.computed(function(){return"yes"==o.is_egoods?!0:!1},this),e.inStock=ko.computed(function(){return e.isEgoods()&&e.count()&&0!=e.count()?"Есть":e.count()&&0!=e.count()?e.count()>=1?"Да":void 0:"Нет"},this),e.sellCost=o.sell_cost,e.keyWords=o.key_words,e.ratingGoods=o.rating_goods,e.sellEndCost=o.sell_end_cost,e.discount=ko.computed(function(){var o=Math.floor(100*(e.sellCost-e.sellEndCost)/e.sellCost);return o>0?o+"%":""},this),e.routeImages=o.route_image,e.routeBigImages=o.route_big_image,e.idAuction=o.id_auction,e.auctionPrice=o.last_cost,e.nameGroupUser=ko.computed(function(){return o.name_group_user?o.name_group_user:null},this),e.ordered=ko.observable(0),(e.count()>0||e.isEgoods())&&e.ordered(1),e.cart=ko.observable(Parameters.cache.cart),e.uniq=EventDispatcher.GetUUID(),e.cssToCart="goodsToCart_"+e.uniq,e.cssTitleToCart="goodsTilteToCart_"+e.uniq,e.cssShareBlock="share",e.Login=function(){Parameters.cache.lastPage=Parameters.cache.history[Parameters.cache.history.length-1],Routing.SetHash("login","Авторизация пользователя",{})},e.Registration=function(){Parameters.cache.lastPage=Parameters.cache.history[Parameters.cache.history.length-1],Routing.SetHash("registration","Регистрация пользователя",{step:1})},e.showSelectionCount=ko.computed(function(){return $.inArray("selectionCount",Config.Goods.showBlocks)>=0&&e.count()&&0!=e.count()?!0:!1},this),e.ClickPlus=function(){e.ordered()<e.count()?e.ordered(e.ordered()+1):e.ShowMessage(Config.Goods.message.maxIsReached,!1,!1)},e.ClickMinus=function(){e.ordered()>0&&e.ordered(e.ordered()-1)},e.showAddToCart=ko.computed(function(){return $.inArray("addToCart",Config.Goods.showBlocks)>=0&&0!=e.count()?!0:!1},this),e.AddToCart=function(){Parameters.cache.cart=e.ordered(),e.cart(e.cart()+e.ordered()),EventDispatcher.DispatchEvent("w.cart.add",{goodsId:e.id,sellerId:e.shopId,count:e.ordered(),hash:e.uniq})},e.showBuy=ko.computed(function(){return $.inArray("buy",Config.Goods.showBlocks)>=0&&0!=e.count()?!0:!1},this),e.Buy=function(){null==Parameters.cache.userInformation||null!=Parameters.cache.userInformation&&Parameters.cache.userInformation.err?(Parameters.cache.lastPage={route:"order",title:"Оформление заказа",data:{create:"directly",sellerId:e.shopId,goodsId:e.id,count:e.ordered()}},Routing.SetHash("login","Авторизация пользователя",{})):Routing.SetHash("order","Оформление заказа",{create:"directly",sellerId:e.shopId,goodsId:e.id,count:e.ordered()})},e.ReportAvailability=function(){},e.showFavorites=ko.computed(function(){return $.inArray("favorites",Config.Goods.showBlocks)>=0&&0!=e.count()?!0:!1},this),e.ToCart=function(){Parameters.cache.lastPage=Parameters.cache.history[Parameters.cache.history.length-1],Routing.SetHash("cart",Config.CartGoods.title,{})},e.BidOnAuction=function(){},e.AddFavorites=function(){null==Parameters.cache.userInformation||Parameters.cache.userInformation.err?e.ShowError(Config.Authentication.message.pleaseLogIn,!1,!1):e.AddCommentForm()},e.comment=ko.observable(""),e.AddCommentForm=function(){e.comment(" "),this.ShowCommentForm(e.comment(),function(o){e.comment(o),EventDispatcher.DispatchEvent("w.fav.add",{goodsId:e.id,comment:e.comment(),data:e})})},e.IsFavorite=ko.observable(),e.IsFavorite($.inArray(e.id,Parameters.cache.favorite)>=0?!0:!1),e.ClickFavorites=function(){Routing.SetHash("favorites","Избранное",{})},e.Gift=function(){},e.Remove=function(){}},GalleryBlockViewModel=function(o){var e=this;e.id=o.id,e.title=o.name_photo,e.thumb=o.route_photo,e.image=o.route_big_photo},ShippingBlockViewModel=function(o){var e=this;e.id=o.id,e.nameMethodShipping=o.name_method_shipping,e.descMethodShipping=o.desc_method_shipping,e.costShipping=ko.computed(function(){return o.cost_shipping?o.cost_shipping:null},this)},MoreBlockViewModel=function(o){var e=this;e.key=o,e.params=[],e.AddParams=function(o){for(var t in o)e.params.push(o[t])}},BuyButtonViewModel=function(o){var e=this;e.showBuy=ko.computed(function(){return o.showAddToCart()?!0:!1},this),e.Buy=function(){Routing.SetHash("order","Оформление заказа",{create:"directly",sellerId:o.shopId,goodsId:o.id,count:o.ordered()})}},AddToCartButtonViewModel=function(o){var e=this;e.showAddToCart=ko.computed(function(){return o.showBuy()?!0:!1},this),e.AddToCart=function(){Parameters.cache.cart=o.ordered(),o.cart(o.cart()+o.ordered()),EventDispatcher.DispatchEvent("w.cart.add",{goodsId:o.id,sellerId:o.sellerId,count:o.ordered(),hash:o.uniq})}};