var RegistrationSellerWidget=function(){var k=this;k.widgetName="RegistrationSellerWidget";k.version=1;k.minWidgetVersion=1;k.maxWidgetVersion=2;k.minTmplVersion=1;k.maxTmplVersion=2;k.InitWidget=a;var s={container:{widget:"content",def:"defaultRegistrationSellerWidgetId"},tmpl:{path:"registrationSellerTmpl.html",id:{step1:"registrationSellerFromStep1Tmpl",step2:"registrationSellerFromStep2Tmpl",step3:"registrationSellerFromStep3Tmpl",step4:"registrationSellerFromStep4Tmpl"}},regular:{nameSeller:/^[а-яёa-zА-ЯЁA-Z0-9_\-\.\s]+$/,email:/^[-._a-zA-Z0-9]+@(?:[a-z0-9][-a-z0-9]+\.)+[a-z]{2,6}$/,phone:/^([\d]{1})\s([\d]{3})\s([\d]{3})\s([\d]{2})\s([\d]{2})(\s([\d]{2}))?$/},error:{nameSeller:{empty:"Поле обязательно для заполнения",minLength:"Минимум 4 символа",maxLength:"Максимум 40 символов",regular:"Только буквы латинского или русского алфавита",uniq:"К сожалению это имя уже занято, попробуйте указать другой вариант"},email:{empty:"Поле обязательно для заполнения",maxLength:"Максимум 64 символа",regular:"Строка не является адресом электронной почты",uniq:'Аккаунт для этого почтового ящика уже существует, рекомендуем пройти процедуру восстановления доступа. <a href="https://pokupo.ru/resetting/request">Восстановить доступ</a>'},phone:{regular:"Не верный формат телефона",uniq:'Аккаунт для этого номера телефона уже существует, рекомендуем пройти процедуру восстановления доступа. <a href="https://pokupo.ru/resetting/request">Восстановить доступ</a>'},isChecked:{empty:"Вам необходимо прочитать и принять условия соглашения"},emailToken:{empty:"Поле обязательно для заполнения",confirm:"Указанный код не принят системой"},phoneToken:{empty:"Поле обязательно для заполнения",confirm:"Указанный код не принят системой"},confirmLater:{empty:"Для активации аккаунта требуется подтвердить хотя бы один из способов связи"},typeSeller:{empty:"Поле обязательно для заполнения",minLength:"Минимум 5 символов",maxLength:"Максимум 40 символов"}},animate:typeof AnimateRegistrationSeller=="function"?AnimateRegistrationSeller:null},l="registration_seller",w="Регистрация продавца";function a(){v();b();t()}function v(){var x=k.GetInputParameters("registrationSeller");if(!$.isEmptyObject(x)){s=k.UpdateSettings1(s,x)}Config.Containers.registrationSeller=s.container}function t(){if(Routing.route==l){var x=Routing.params;if(!x.step){x.step=1}k.BaseLoad.Tmpl(s.tmpl,function(){if(x.step==1){j();q()}if(x.step==2){h();p()}if(x.step==3){f();o()}if(x.step==4){d();m()}})}else{k.WidgetLoader(true)}}function b(){k.AddEvent("w.change.route",function(){t()});k.AddEvent("RSeller.step1.register",function(x){k.WidgetLoader(false);var z=[];if(x.nameSeller()){z.push("name_seller="+encodeURIComponent(x.nameSeller()))}if(x.phone()){z.push("phone_seller="+x.phone().replace(/\s/g,""))}if(x.email()){z.push("email_seller="+$.trim(x.email()))}if(z.length>0){var y="?"+z.join("&")}k.BaseLoad.RegistrationSeller(y,function(A){if(k.QueryError(A,function(){k.DispatchEvent("RSeller.step1.register",x)})){Parameters.cache.regSeller.step1=x;u(l,w,{step:2})}else{k.WidgetLoader(true,s.container.widget)}})});k.AddEvent("RSeller.step2.checking",function(x){Parameters.cache.regSeller.step2=x;u(l,w,{step:3})});k.AddEvent("RSeller.step3.checking",function(x){k.WidgetLoader(false);var z=Parameters.cache.regSeller.step1;var y=Parameters.cache.regSeller.step2;Parameters.cache.regSeller.step3=x;var B=[];if(z.nameSeller()){B.push("name_seller="+encodeURIComponent(z.nameSeller()))}B.push("mail_token="+encodeURIComponent(y.mailToken()?y.mailToken():1));B.push("sms_token="+encodeURIComponent(y.phoneToken()?y.phoneToken():1));if(x.typeSeller()){B.push("type_seller="+x.typeSeller())}if(x.invite()){B.push("invite="+encodeURIComponent(x.invite()))}if(x.site()){B.push("site="+encodeURIComponent(x.site()))}var A="?"+B.join("&");k.BaseLoad.ActivateSeller(A,function(C){if(k.QueryError(C,function(){k.DispatchEvent("RSeller.step3.checking",x)})){u(l,w,{step:4})}else{k.WidgetLoader(true,s.container.widget)}})})}function n(){k.ClearContainer(s)}function j(){k.InsertContainer(s,"step1")}function h(){k.InsertContainer(s,"step2")}function f(){k.InsertContainer(s,"step3")}function d(){k.InsertContainer(s,"step4")}function r(){RegistrationSellerFormViewModel.prototype.Back=function(){Parameters.cache.history.pop();var x=Parameters.cache.history.pop();if(x){u(x.route,x.title,x.data,true)}else{u("default","Домашняя",{})}};return new RegistrationSellerFormViewModel(s)}function q(){var x=Parameters.cache.regSeller.step1;if($.isEmptyObject(x)){x=r()}i(x)}function p(){var A=Routing.params;if(A.username&&A.mail_token){var y=r();y.nameSeller(A.username);Parameters.cache.regSeller.step1=y}var x=Parameters.cache.regSeller.step1;if(!x.nameSeller){u(l,w,{});return true}var z=new RegistrationSellerConfirmFormViewModel(x,s);if(A.username&&A.mail_token){z.mailToken(A.mail_token);k.DispatchEvent("RSeller.step2.checking",z);return true}g(z)}function o(){var x=Parameters.cache.regSeller.step3;if($.isEmptyObject(x)){x=new RegistrationSellerFinishFormViewModel(s)}if(!Parameters.cache.regSeller.step1.nameSeller){u(l,w,{});return true}e(x)}function m(){if(!Parameters.cache.regSeller.step1.nameSeller){u(l,w,{});return true}Parameters.cache.regSeller={step1:{},step2:{},step3:{}};c()}function i(x){k.RenderTemplate(x,s,null,function(y){j();i(y)},function(y){n()})}function g(x){k.RenderTemplate(x,s,null,function(y){h();g(y)},function(y){n()})}function e(x){k.RenderTemplate(x,s,null,function(y){f();e(y)},function(y){n()})}function c(){k.WidgetLoader(true,s.container.widget);if(s.animate){s.animate()}}function u(x,z,y){Routing.SetHash(x,z,y)}};var RegistrationSellerFormViewModel=function(b){var a=this;a.nameSeller=ko.observable(null);a.errorNameSeller=ko.observable(null);a.email=ko.observable(null);a.errorEmail=ko.observable(null);a.cssPhone="phone";a.phone=ko.observable(null);a.errorPhone=ko.observable(null);a.isChecked=ko.observable(false);a.errorIsChecked=ko.observable(null);a.SubmitForm=function(){if(a.ValidationForm()){EventDispatcher.DispatchEvent("RSeller.step1.register",a)}};a.ValidationForm=function(){var c=true;if(!a.NameValidation()){c=false}if(!a.EmailValidation()){c=false}if(!a.PhoneValidation()){c=false}if(!a.IsCheckedValidation()){c=false}return c};a.NameValidation=function(){var c=b.error.nameSeller;if(!a.nameSeller()){a.errorNameSeller(c.empty);return false}if(a.nameSeller().length<3){a.errorNameSeller(c.minLength);return false}if(a.nameSeller().length>40){a.errorNameSeller(c.maxLength);return false}if(!b.regular.nameSeller.test(a.nameSeller())){a.errorNameSeller(c.regular);return false}a.errorNameSeller(null);return true};a.EmailValidation=function(){var c=b.error.email;if(!a.email()){a.errorEmail(c.empty);return false}if(a.email().length>64){a.errorEmail(c.maxLength);return false}if(!b.regular.email.test(a.email())){a.errorEmail(c.regular);return false}a.errorEmail(null);return true};a.PhoneValidation=function(){if(a.phone()){if(!b.regular.phone.test($.trim(a.phone()))){a.errorPhone(b.error.phone.regular);return false}}a.errorPhone(null);return true};a.IsCheckedValidation=function(){if(!a.isChecked()){a.errorIsChecked(b.error.isChecked.empty);return false}a.errorIsChecked(null);return true};a.RestoreAccess=function(){};a.agreement="http://"+window.location.hostname+"/rules";a.police="http://"+window.location.hostname+"/police";a.refund="http://"+window.location.hostname+"/refund"};var RegistrationSellerConfirmFormViewModel=function(b,c){var a=this;a.nameSeller=b.nameSeller();a.cssMailToken="mail_token_block";a.mailToken=ko.observable();a.mailIsConfirm=ko.observable(false);a.errorEmailConfirm=ko.observable(null);a.mailConfirmLater=ko.observable(false);a.cssPhoneToken="phone_token_block";a.phoneToken=ko.observable();a.phoneIsConfirm=ko.observable(false);a.errorPhoneConfirm=ko.observable(null);a.phoneConfirmLater=ko.observable(false);a.errorConfirmLater=ko.observable(null);a.isEmptyPhone=ko.computed(function(){if(!$.isEmptyObject(b)&&b.phone()){return false}a.phoneConfirmLater(true);return true},this);a.submitEvent=ko.observable();a.SubmitForm=function(){if(a.ValidationForm()){EventDispatcher.DispatchEvent("RSeller.step2.checking",a)}};a.ValidationForm=function(){var d=true;if(!a.EmailTokenValidation()){d=false}if(!a.PhoneTokenValidation()){d=false}if(!a.EmptyConfirm()){d=false}return d};a.EmailTokenValidation=function(){if(!a.mailConfirmLater()){if(!a.mailToken()){a.errorEmailConfirm(c.error.emailToken.empty);return false}}a.errorEmailConfirm(null);return true};a.PhoneTokenValidation=function(){if(!a.phoneConfirmLater()){if(!a.phoneToken()){a.errorPhoneConfirm(c.error.phoneToken.empty);return false}}a.errorPhoneConfirm(null);return true};a.EmptyConfirm=function(){if(a.phoneConfirmLater()&&a.mailConfirmLater()){a.errorConfirmLater(c.error.confirmLater.empty);a.errorEmailConfirm(null);a.errorPhoneConfirm(null);return false}else{a.errorConfirmLater(null)}return true};a.Back=function(){Parameters.cache.regSeller.step3=a;Routing.SetHash("registration_seller","Регистрация продавца",{step:1})}};var RegistrationSellerFinishFormViewModel=function(b){var a=this;a.typeSeller=ko.observable();a.errorTypeSeller=ko.observable();a.invite=ko.observable();a.errorInvite=ko.observable();a.site=ko.observable("http://");a.errorSite=ko.observable();a.confirmLater=ko.observable(false);a.confirmLater.subscribe(function(c){if(!c){a.invite("");a.site("http://")}});a.errorConfirmLater=ko.observable(null);a.SubmitForm=function(){if(a.ValidationForm()){EventDispatcher.DispatchEvent("RSeller.step3.checking",a)}};a.ValidationForm=function(){var c=true;if(!a.TypeSellerValidation()){c=false}if(!a.InviteValidation()){c=false}if(!a.SiteValidation()){c=false}return c};a.Back=function(){Routing.SetHash("registration_seller","Регистрация пользователя",{step:2})};a.TypeSellerValidation=function(){if(!a.typeSeller()){a.errorTypeSeller(b.error.typeSeller.empty);return false}a.errorTypeSeller(null);return true};a.InviteValidation=function(){if(a.invite()){if(a.invite().length<5){a.errorInvite(b.error.invite.minLength);return false}if(a.invite().length>40){a.errorInvite(b.error.invite.maxLength);return false}}a.errorInvite(null);return true};a.SiteValidation=function(){if(a.site()){if(a.site()=="http://"){a.site("")}}a.errorSite(null);return true}};var TestRegistrationSeller={Init:function(){if(typeof Widget=="function"){RegistrationSellerWidget.prototype=new Widget();var a=new RegistrationSellerWidget();a.Init(a)}else{setTimeout(function(){TestRegistrationSeller.Init()},100)}}};TestRegistrationSeller.Init();