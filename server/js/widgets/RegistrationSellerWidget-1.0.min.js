var RegistrationSellerWidget=function(){function e(){r(),t(),n()}function r(){var e=k.GetInputParameters("registrationSeller");$.isEmptyObject(e)||(b=k.UpdateSettings1(b,e)),Config.RegistrationSeller=b}function n(){if(Routing.route==C){var e=Routing.params;e.step||(e.step=1),k.BaseLoad.Tmpl(b.tmpl,function(){1==e.step&&(i(),p()),2==e.step&&(l(),u()),3==e.step&&(a(),c()),4==e.step&&(s(),h())})}else k.WidgetLoader(!0)}function t(){k.AddEvent("w.change.route",function(){n()}),k.AddEvent("RSeller.step1.register",function(e){k.WidgetLoader(!1);var r=[];if(e.nameSeller()&&r.push("name_seller="+encodeURIComponent(e.nameSeller())),e.phone()&&r.push("phone_seller="+e.phone().replace(/\s/g,"")),e.email()&&r.push("email_seller="+$.trim(e.email())),r.length>0)var n="?"+r.join("&");k.BaseLoad.RegistrationSeller(n,function(r){k.QueryError(r,function(){k.DispatchEvent("RSeller.step1.register",e)})?(Parameters.cache.regSeller.step1=e,v(C,R,{step:2})):k.WidgetLoader(!0,b.container.widget)})}),k.AddEvent("RSeller.step2.checking",function(e){Parameters.cache.regSeller.step2=e,v(C,R,{step:3})}),k.AddEvent("RSeller.step3.checking",function(e){k.WidgetLoader(!1);var r=Parameters.cache.regSeller.step1,n=Parameters.cache.regSeller.step2;Parameters.cache.regSeller.step3=e;var t=[];r.nameSeller()&&t.push("name_seller="+encodeURIComponent(r.nameSeller())),t.push("mail_token="+encodeURIComponent(n.mailToken()?n.mailToken():1)),t.push("sms_token="+encodeURIComponent(n.phoneToken()?n.phoneToken():1)),e.typeSeller()&&t.push("type_seller="+e.typeSeller()),e.invite()&&t.push("invite="+encodeURIComponent(e.invite())),e.site()&&t.push("site="+encodeURIComponent(e.site()));var o="?"+t.join("&");k.BaseLoad.ActivateSeller(o,function(r){k.QueryError(r,function(){k.DispatchEvent("RSeller.step3.checking",e)})?v(C,R,{step:4}):k.WidgetLoader(!0,b.container.widget)})})}function o(){k.ClearContainer(b)}function i(){k.InsertContainer(b,"step1")}function l(){k.InsertContainer(b,"step2")}function a(){k.InsertContainer(b,"step3")}function s(){k.InsertContainer(b,"step4")}function m(){return RegistrationSellerFormViewModel.prototype.Back=function(){Parameters.cache.history.pop();var e=Parameters.cache.history.pop();e?v(e.route,e.title,e.data,!0):v("default","Домашняя",{})},new RegistrationSellerFormViewModel(b)}function p(){var e=Parameters.cache.regSeller.step1;$.isEmptyObject(e)&&(e=m()),f(e)}function u(){var e=Routing.params;if(e.username&&e.mail_token){var r=m();r.nameSeller(e.username),Parameters.cache.regSeller.step1=r}var n=Parameters.cache.regSeller.step1;if(!n.nameSeller)return v(C,R,{}),!0;var t=new RegistrationSellerConfirmFormViewModel(n,b);return e.username&&e.mail_token?(t.mailToken(e.mail_token),k.DispatchEvent("RSeller.step2.checking",t),!0):void g(t)}function c(){var e=Parameters.cache.regSeller.step3;return $.isEmptyObject(e)&&(e=new RegistrationSellerFinishFormViewModel(b)),Parameters.cache.regSeller.step1.nameSeller?void d(e):(v(C,R,{}),!0)}function h(){return Parameters.cache.regSeller.step1.nameSeller?(Parameters.cache.regSeller={step1:{},step2:{},step3:{}},void S()):(v(C,R,{}),!0)}function f(e){k.RenderTemplate(e,b,null,function(e){i(),f(e)},function(){o()})}function g(e){k.RenderTemplate(e,b,null,function(e){l(),g(e)},function(){o()})}function d(e){k.RenderTemplate(e,b,null,function(e){a(),d(e)},function(){o()})}function S(){k.WidgetLoader(!0,b.container.widget),b.animate&&b.animate()}function v(e,r,n){Routing.SetHash(e,r,n)}var k=this;k.widgetName="RegistrationSellerWidget",k.version=1,k.minWidgetVersion=1,k.maxWidgetVersion=2,k.minTmplVersion=1,k.maxTmplVersion=2,k.InitWidget=e;var b={container:{widget:"content",def:"defaultRegistrationSellerWidgetId"},tmpl:{path:"registrationSellerTmpl.html",id:{step1:"registrationSellerFromStep1Tmpl",step2:"registrationSellerFromStep2Tmpl",step3:"registrationSellerFromStep3Tmpl",step4:"registrationSellerFromStep4Tmpl"}},regular:{nameSeller:/^[а-яёa-zА-ЯЁA-Z0-9_\-\.\s]+$/,email:/^[-._a-zA-Z0-9]+@(?:[a-z0-9][-a-z0-9]+\.)+[a-z]{2,6}$/,phone:/^([\d]{1})\s([\d]{3})\s([\d]{3})\s([\d]{2})\s([\d]{2})(\s([\d]{2}))?$/},error:{nameSeller:{empty:"Поле обязательно для заполнения",minLength:"Минимум 4 символа",maxLength:"Максимум 40 символов",regular:"Только буквы латинского или русского алфавита",uniq:"К сожалению это имя уже занято, попробуйте указать другой вариант"},email:{empty:"Поле обязательно для заполнения",maxLength:"Максимум 64 символа",regular:"Строка не является адресом электронной почты",uniq:'Аккаунт для этого почтового ящика уже существует, рекомендуем пройти процедуру восстановления доступа. <a href="https://pokupo.ru/resetting/request">Восстановить доступ</a>'},phone:{regular:"Не верный формат телефона",uniq:'Аккаунт для этого номера телефона уже существует, рекомендуем пройти процедуру восстановления доступа. <a href="https://pokupo.ru/resetting/request">Восстановить доступ</a>'},isChecked:{empty:"Вам необходимо прочитать и принять условия соглашения"},emailToken:{empty:"Поле обязательно для заполнения",confirm:"Указанный код не принят системой"},phoneToken:{empty:"Поле обязательно для заполнения",confirm:"Указанный код не принят системой"},confirmLater:{empty:"Для активации аккаунта требуется подтвердить хотя бы один из способов связи"},typeSeller:{empty:"Поле обязательно для заполнения",minLength:"Минимум 5 символов",maxLength:"Максимум 40 символов"}},animate:"function"==typeof AnimateRegistrationSeller?AnimateRegistrationSeller:null},C="registration_seller",R="Регистрация продавца"},RegistrationSellerFormViewModel=function(e){var r=this;r.nameSeller=ko.observable(null),r.errorNameSeller=ko.observable(null),r.email=ko.observable(null),r.errorEmail=ko.observable(null),r.cssPhone="phone",r.phone=ko.observable(null),r.errorPhone=ko.observable(null),r.isChecked=ko.observable(!1),r.errorIsChecked=ko.observable(null),r.SubmitForm=function(){r.ValidationForm()&&EventDispatcher.DispatchEvent("RSeller.step1.register",r)},r.ValidationForm=function(){var e=!0;return r.NameValidation()||(e=!1),r.EmailValidation()||(e=!1),r.PhoneValidation()||(e=!1),r.IsCheckedValidation()||(e=!1),e},r.NameValidation=function(){var n=e.error.nameSeller;return r.nameSeller()?r.nameSeller().length<3?(r.errorNameSeller(n.minLength),!1):r.nameSeller().length>40?(r.errorNameSeller(n.maxLength),!1):e.regular.nameSeller.test(r.nameSeller())?(r.errorNameSeller(null),!0):(r.errorNameSeller(n.regular),!1):(r.errorNameSeller(n.empty),!1)},r.EmailValidation=function(){var n=Config.Registration.error.email;return r.email()?r.email().length>64?(r.errorEmail(n.maxLength),!1):e.regular.email.test(r.email())?(r.errorEmail(null),!0):(r.errorEmail(n.regular),!1):(r.errorEmail(n.empty),!1)},r.PhoneValidation=function(){return r.phone()&&!e.regular.phone.test($.trim(r.phone()))?(r.errorPhone(e.error.phone.regular),!1):(r.errorPhone(null),!0)},r.IsCheckedValidation=function(){return r.isChecked()?(r.errorIsChecked(null),!0):(r.errorIsChecked(e.error.isChecked.empty),!1)},r.RestoreAccess=function(){},r.agreement="http://"+window.location.hostname+"/rules",r.police="http://"+window.location.hostname+"/police",r.refund="http://"+window.location.hostname+"/refund"},RegistrationSellerConfirmFormViewModel=function(e,r){var n=this;n.nameSeller=e.nameSeller(),n.cssMailToken="mail_token_block",n.mailToken=ko.observable(),n.mailIsConfirm=ko.observable(!1),n.errorEmailConfirm=ko.observable(null),n.mailConfirmLater=ko.observable(!1),n.cssPhoneToken="phone_token_block",n.phoneToken=ko.observable(),n.phoneIsConfirm=ko.observable(!1),n.errorPhoneConfirm=ko.observable(null),n.phoneConfirmLater=ko.observable(!1),n.errorConfirmLater=ko.observable(null),n.isEmptyPhone=ko.computed(function(){return!$.isEmptyObject(e)&&e.phone()?!1:(n.phoneConfirmLater(!0),!0)},this),n.submitEvent=ko.observable(),n.SubmitForm=function(){n.ValidationForm()&&EventDispatcher.DispatchEvent("RSeller.step2.checking",n)},n.ValidationForm=function(){var e=!0;return n.EmailTokenValidation()||(e=!1),n.PhoneTokenValidation()||(e=!1),n.EmptyConfirm()||(e=!1),e},n.EmailTokenValidation=function(){return n.mailConfirmLater()||n.mailToken()?(n.errorEmailConfirm(null),!0):(n.errorEmailConfirm(r.error.emailToken.empty),!1)},n.PhoneTokenValidation=function(){return n.phoneConfirmLater()||n.phoneToken()?(n.errorPhoneConfirm(null),!0):(n.errorPhoneConfirm(r.error.phoneToken.empty),!1)},n.EmptyConfirm=function(){return n.phoneConfirmLater()&&n.mailConfirmLater()?(n.errorConfirmLater(r.error.confirmLater.empty),n.errorEmailConfirm(null),n.errorPhoneConfirm(null),!1):(n.errorConfirmLater(null),!0)},n.Back=function(){Parameters.cache.regSeller.step3=n,Routing.SetHash("registration_seller","Регистрация продавца",{step:1})}},RegistrationSellerFinishFormViewModel=function(e){var r=this;r.typeSeller=ko.observable(),r.errorTypeSeller=ko.observable(),r.invite=ko.observable(),r.errorInvite=ko.observable(),r.site=ko.observable("http://"),r.errorSite=ko.observable(),r.confirmLater=ko.observable(!1),r.confirmLater.subscribe(function(e){e||(r.invite(""),r.site("http://"))}),r.errorConfirmLater=ko.observable(null),r.SubmitForm=function(){r.ValidationForm()&&EventDispatcher.DispatchEvent("RSeller.step3.checking",r)},r.ValidationForm=function(){var e=!0;return r.TypeSellerValidation()||(e=!1),r.InviteValidation()||(e=!1),r.SiteValidation()||(e=!1),e},r.Back=function(){Routing.SetHash("registration_seller","Регистрация пользователя",{step:2})},r.TypeSellerValidation=function(){return r.typeSeller()?(r.errorTypeSeller(null),!0):(r.errorTypeSeller(e.error.typeSeller.empty),!1)},r.InviteValidation=function(){if(r.invite()){if(r.invite().length<5)return r.errorInvite(e.error.invite.minLength),!1;if(r.invite().length>40)return r.errorInvite(e.error.invite.maxLength),!1}return r.errorInvite(null),!0},r.SiteValidation=function(){return r.site()&&"http://"==r.site()&&r.site(""),r.errorSite(null),!0}},TestRegistrationSeller={Init:function(){if("function"==typeof Widget){RegistrationSellerWidget.prototype=new Widget;var e=new RegistrationSellerWidget;e.Init(e)}else setTimeout(function(){TestRegistrationSeller.Init()},100)}};TestRegistrationSeller.Init();