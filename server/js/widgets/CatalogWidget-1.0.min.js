var CatalogWidget=function(){function t(){o(),e(),a()}function e(){var t=l.GetInputParameters("catalog");$.isEmptyObject(t)||(s=l.UpdateSettings1(s,t)),Config.Catalog=s}function a(){"catalog"==Routing.route||"goods"==Routing.route||Routing.IsDefault()&&!l.HasDefaultContent()?l.BaseLoad.Tmpl(s.tmpl,function(){l.BaseLoad.Roots(function(){c()})}):l.WidgetLoader(!0)}function o(){l.AddEvent("catalogWidget.fill.section",function(t){g(t)}),l.AddEvent("w.change.route",function(){a()})}function i(){l.ClearContainer(s)}function n(){l.InsertContainer(s)}function c(){Parameters.cache.catalogs[Routing.GetActiveCategory()]?Parameters.cache.catalogs[Routing.GetActiveCategory()]?(n(),l.BaseLoad.Roots(function(t){r(t)})):l.WidgetLoader(!0):(n(),l.BaseLoad.Section(Routing.GetActiveCategory(),function(t){l.BaseLoad.Path(Routing.GetActiveCategory(),function(e){if(e[e.length-1]){var a=[];a[0]={id:e[e.length-1].id,name_category:e[e.length-1].name_category,type_category:"section",back:"return",children:Parameters.cache.childrenCategory[Routing.GetActiveCategory()]},r(a)}else r(t)})}))}function r(t){for(var e=new CatalogViewModel,a=0;a<=t.length-1;a++)e.AddItem(t[a]);l.DispatchEvent("catalogWidget.fill.section",e)}function g(t){l.RenderTemplate(t,s,null,function(t){n(),g(t)},function(){i()})}var l=this;l.widgetName="CatalogWidget",l.version=1,l.minWidgetVersion=1,l.maxWidgetVersion=2,l.minTmplVersion=1,l.maxTmplVersion=2,l.InitWidget=t;var s={container:{widget:"catalogWidgetId",def:"defaultCatalogWidgetId"},tmpl:{path:"catalogTmpl.html",id:"catalogTmpl"},animate:"function"==typeof AnimateCatalog?AnimateCatalog:null}},CatalogViewModel=function(){var t=this;t.tab=ko.observableArray(),t.AddItem=function(e){var a=new SectionViewModel(e,t.tab());if(e.children)for(var o=0;o<=e.children.length-1;o++){var i=new ItemViewModel(e.children[o],e.id);if(e.children[o].children)for(var n=0;n<=e.children[o].children.length-1;n++){var c=new ItemViewModel(e.children[o].children[n],e.children[o].id);i.children.push(c)}a.children.push(i)}t.tab.push(a)}},SectionViewModel=function(t,e){var a=this;a.id=t.id,a.title=ko.computed(function(){return t.back?"Вверх":t.name_category},this),a.type_category=t.type_category,a.listClass="catalogCategories_"+t.id,a.tabClass=ko.computed(function(){var a="listCategories_"+t.id;return 1==e.length&&(a+=" single"),Routing.GetActiveCategory()==t.id?t.back?a+" return active":a+" active":a},this),a.countGoods=t.count_goods,a.children=ko.observableArray(),a.titleWithCount=ko.computed(function(){if(t.back)return"Вверх";var e=t.name_category;return t.count_goods&&t.count_goods>0&&(e=e+" <span>"+t.count_goods+"</span>"),e},this),a.isActive=ko.computed(function(){return Routing.GetActiveCategory()==a.id?!0:!1},this),a.ClickTab=function(){if(Parameters.cache.catalogs[a.id]){var e=$(".listCategories_"+a.id)[0].tagName;$(e+"[class^=listCategories]").removeClass("active"),$(".listCategories_"+a.id).addClass("active");var o=$(".catalogCategories_"+t.id)[0].tagName;$(o+"[class*=catalogCategories]").hide(),$(".catalogCategories_"+t.id).show(),params={section:t.id},Routing.SetHash("catalog",t.name_category,params)}else{var i=Parameters.cache.path[a.id].path;params={section:i[i.length-2].id},Routing.SetHash("catalog",i[i.length-2].name_category,params)}}},ItemViewModel=function(t,e){var a=this;a.id=t.id,a.title=t.name_category,a.countGoods=t.count_goods,a.children=ko.observableArray(),a.titleWithCount=ko.computed(function(){var e=t.name_category;return t.count_goods&&t.count_goods>0&&(e=e+" <span>"+t.count_goods+"</span>"),e},this),a.hasChildren=ko.computed(function(){return a.children().length>0?!0:!1},this),a.liClass=ko.computed(function(){return a.hasChildren()?"menuparent":""},this),a.ClickItem=function(){var o;o="category"==t.type_category?{section:e,category:t.id}:{section:t.id},Routing.SetHash("catalog",a.title,o)}},TestCatalog={Init:function(){if("function"==typeof Widget){CatalogWidget.prototype=new Widget;var t=new CatalogWidget;t.Init(t)}else setTimeout(function(){TestCatalog.Init()},100)}};TestCatalog.Init();