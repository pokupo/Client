var CatalogWidget=function(){var j=this;j.widgetName="CatalogWidget";j.version=1;j.minWidgetVersion=1;j.maxWidgetVersion=2;j.minTmplVersion=1;j.maxTmplVersion=2;j.InitWidget=f;var d={container:{widget:"catalogWidgetId",def:"defaultCatalogWidgetId"},tmpl:{path:"catalogTmpl.html",id:"catalogTmpl"},animate:typeof AnimateCatalog=="function"?AnimateCatalog:null};function f(){i();b();j.CheckRouteCatalog()}function b(){var k=j.GetInputParameters("catalog");if(!$.isEmptyObject(k)){d=j.UpdateSettings1(d,k)}Config.Containers.catalog=d.container}j.CheckRouteCatalog=function(){if(Routing.route=="catalog"||Routing.route=="goods"||(Routing.IsDefault()&&!j.HasDefaultContent())){j.BaseLoad.Tmpl(d.tmpl,function(){j.BaseLoad.Roots(function(k){if(!k.err){h()}else{j.WidgetLoader(true)}})})}else{j.WidgetLoader(true)}};function i(){j.AddEvent("catalogWidget.fill.section",function(k){e(k)});j.AddEvent("w.change.route",function(){j.CheckRouteCatalog()})}function a(){j.ClearContainer(d)}function g(){j.InsertContainer(d)}function h(){if(!Parameters.cache.catalogs[Routing.GetActiveCategory()]){g();j.BaseLoad.Section(Routing.GetActiveCategory(),function(k){j.BaseLoad.Path(Routing.GetActiveCategory(),function(m){if(m[m.length-1]){var l=[];l[0]={id:m[m.length-1].id,name_category:m[m.length-1].name_category,type_category:"section",back:"return",children:Parameters.cache.childrenCategory[Routing.GetActiveCategory()]};c(l)}else{c(k)}})})}else{if(Parameters.cache.catalogs[Routing.GetActiveCategory()]){g();j.BaseLoad.Roots(function(k){c(k)})}else{j.WidgetLoader(true)}}}function c(m){var k=new CatalogViewModel();for(var l=0;l<=m.length-1;l++){k.AddItem(m[l])}j.DispatchEvent("catalogWidget.fill.section",k)}function e(k){j.RenderTemplate(k,d,null,function(l){g();e(l)},function(){a()})}};var CatalogViewModel=function(){var a=this;a.tab=ko.observableArray();a.AddItem=function(f){var g=new SectionViewModel(f,a.tab());if(f.children){for(var e=0;e<=f.children.length-1;e++){var c=new ItemViewModel(f.children[e],f.id);if(f.children[e].children){for(var d=0;d<=f.children[e].children.length-1;d++){var b=new ItemViewModel(f.children[e].children[d],f.children[e].id);c.children.push(b)}}g.children.push(c)}}a.tab.push(g)}};var SectionViewModel=function(c,b){var a=this;a.id=c.id;a.title=ko.computed(function(){if(c.back){return"Вверх"}return c.name_category},this);a.type_category=c.type_category;a.listClass="catalogCategories_"+c.id;a.tabClass=ko.computed(function(){var d="listCategories_"+c.id;if(b.length==1){d=d+" single"}if(Routing.GetActiveCategory()==c.id){if(c.back){return d+" return active"}else{return d+" active"}}else{return d}},this);a.countGoods=c.count_goods;a.children=ko.observableArray();a.titleWithCount=ko.computed(function(){if(c.back){return"Вверх"}else{var d=c.name_category;if(c.count_goods&&c.count_goods>0){d=d+" <span>"+c.count_goods+"</span>"}return d}},this);a.isActive=ko.computed(function(){if(Routing.GetActiveCategory()==a.id){return true}return false},this);a.ClickTab=function(){if(Parameters.cache.catalogs[a.id]){var e=$(".listCategories_"+a.id)[0].tagName;$(e+"[class^=listCategories]").removeClass("active");$(".listCategories_"+a.id).addClass("active");var d=$(".catalogCategories_"+c.id)[0].tagName;$(d+"[class*=catalogCategories]").hide();$(".catalogCategories_"+c.id).show();params={section:c.id};Routing.SetHash("catalog",c.name_category,params)}else{var f=Parameters.cache.path[a.id].path;params={section:f[f.length-2].id};Routing.SetHash("catalog",f[f.length-2].name_category,params)}}};var ItemViewModel=function(c,b){var a=this;a.id=c.id;a.title=c.name_category;a.countGoods=c.count_goods;a.children=ko.observableArray();a.titleWithCount=ko.computed(function(){var d=c.name_category;if(c.count_goods&&c.count_goods>0){d=d+" <span>"+c.count_goods+"</span>"}return d},this);a.hasChildren=ko.computed(function(){if(a.children().length>0){return true}return false},this);a.liClass=ko.computed(function(){if(a.hasChildren()){return"menuparent"}return""},this);a.ClickItem=function(){var d;if(c.type_category=="category"){d={section:b,category:c.id}}else{d={section:c.id}}Routing.SetHash("catalog",a.title,d)}};var TestCatalog={Init:function(){if(typeof Widget=="function"){CatalogWidget.prototype=new Widget();var a=new CatalogWidget();a.Init(a)}else{setTimeout(function(){TestCatalog.Init()},100)}}};TestCatalog.Init();